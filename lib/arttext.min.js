/*! ArtText v0.1.1 */!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=10)}([function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var r=n(3),i=n.n(r),o=n(6),s={insert:"head",singleton:!1},a=(i()(o.a,s),o.a.locals,function(){function e(e){this.artText=e}return e.loadScript=function(e,t){var n=document.createElement("script");n.type="text/javascript",void 0!==t&&(n.onload=function(){t()}),n.src=e,document.body.appendChild(n)},e.loadCss=function(e){var t=document.getElementsByTagName("head")[0],n=document.createElement("link");n.rel="stylesheet",n.type="text/css",n.href=e,t.appendChild(n)},e.addCss=function(e){if(null==e||""==e)return!1;var t=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");return n.type="text/css",n.appendChild(document.createTextNode(e)),t.appendChild(n),!0},e.hasClass=function(e,t){return(" "+e.className+" ").indexOf(" "+t+" ")>-1},e.insertAfter=function(e,t,n){e.lastChild==n?e.appendChild(t):e.insertBefore(t,n.previousElementSibling)},e.prototype.add=function(e){if(Array.isArray(e))for(var t=0,n=e;t<n.length;t++){var r=n[t],i=r.dom,o=r.place;this.insertDom(i,o)}else{i=e.dom,o=e.place;this.insertDom(i,o)}},e.prototype.insertDom=function(t,n){switch(n){case"Editor.before":this.artText.dom.insertBefore(t,this.artText.get("$editor").dom);break;case"Editor.after":e.insertAfter(this.artText.dom,t,this.artText.get("$editor").dom);break;default:this.artText.dom.appendChild(t)}},e}()),l=(t.b=a,{install:function(e,t){t.container.bind("$tool",a,[{get:"art"}],!0)},created:function(e,t){e.get("$tool")}})},function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"a",(function(){return s}));var r=n(0),i=function(){function e(){this.bindMap=new Map}return e.prototype.bind=function(e,t,n,r){void 0===r&&(r=!1),this.bindMap.set(e,{clazz:t,constructorArgs:n||[],renderFlag:r})},e.prototype.get=function(e,t){var n=this.bindMap.get(e),r=n.clazz,i=n.constructorArgs;if(n.renderFlag){for(var o=[],s=0,a=i;s<a.length;s++){var l=a[s];l.constructor===Object?"art"==l.get?o.push(t):o.push(t.get(l.get)):o.push(l)}return Reflect.construct(r,o)}return Reflect.construct(r,i)},e.prototype.has=function(e){return this.bindMap.has(e)},e}(),o=function(){function e(){}return e.use=function(t){t.install&&t.install(s,e.options),e.plugins.push(t)},e.createdArt=function(t){for(var n=0,r=e.plugins;n<r.length;n++){var i=r[n];i.created&&i.created(t,e.options)}},e.mountArt=function(t){for(var n=0,r=e.plugins;n<r.length;n++){var i=r[n];i.mount&&i.mount(t,e.options)}},e.unmountArt=function(t){for(var n=0,r=e.plugins;n<r.length;n++){var i=r[n];i.unmount&&i.unmount(t,e.options)}},e.plugins=[],e.container=new i,e.options={container:e.container,Tool:r.b},e}(),s=function(){function e(){}return e.prototype.get=function(e){return null==this[e]&&(this[e]=o.container.get(e,this)),this[e]},e.prototype.set=function(e,t){null==this[e]&&o.container.has(e)&&(this[e]=o.container.get(e,this)),this[e]=t},e}()},function(e,t,n){"use strict";var r,i;n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return l})),function(e){e.editor="editor",e.read="read",e.read_noStyle="read-noStyle"}(r||(r={})),function(e){e.strict="strict",e.loose="loose"}(i||(i={}));var o={defaultMd:"",markdown:"",fileInfo:{},runModel:r.editor,securityLevel:i.strict},s={backgroundColor:"#fff",color:"#1abc9c"},a=function(){function e(){}return e.theme=s,e}(),l=window},function(e,t,n){"use strict";var r,i=function(){return void 0===r&&(r=Boolean(window&&document&&document.all&&!window.atob)),r},o=function(){var e={};return function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}e[t]=n}return e[t]}}(),s=[];function a(e){for(var t=-1,n=0;n<s.length;n++)if(s[n].identifier===e){t=n;break}return t}function l(e,t){for(var n={},r=[],i=0;i<e.length;i++){var o=e[i],l=t.base?o[0]+t.base:o[0],d=n[l]||0,c="".concat(l," ").concat(d);n[l]=d+1;var h=a(c),p={css:o[1],media:o[2],sourceMap:o[3]};-1!==h?(s[h].references++,s[h].updater(p)):s.push({identifier:c,updater:g(p,t),references:1}),r.push(c)}return r}function d(e){var t=document.createElement("style"),r=e.attributes||{};if(void 0===r.nonce){var i=n.nc;i&&(r.nonce=i)}if(Object.keys(r).forEach((function(e){t.setAttribute(e,r[e])})),"function"==typeof e.insert)e.insert(t);else{var s=o(e.insert||"head");if(!s)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");s.appendChild(t)}return t}var c,h=(c=[],function(e,t){return c[e]=t,c.filter(Boolean).join("\n")});function p(e,t,n,r){var i=n?"":r.media?"@media ".concat(r.media," {").concat(r.css,"}"):r.css;if(e.styleSheet)e.styleSheet.cssText=h(t,i);else{var o=document.createTextNode(i),s=e.childNodes;s[t]&&e.removeChild(s[t]),s.length?e.insertBefore(o,s[t]):e.appendChild(o)}}function u(e,t,n){var r=n.css,i=n.media,o=n.sourceMap;if(i?e.setAttribute("media",i):e.removeAttribute("media"),o&&"undefined"!=typeof btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),e.styleSheet)e.styleSheet.cssText=r;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(r))}}var f=null,m=0;function g(e,t){var n,r,i;if(t.singleton){var o=m++;n=f||(f=d(t)),r=p.bind(null,n,o,!1),i=p.bind(null,n,o,!0)}else n=d(t),r=u.bind(null,n,t),i=function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(n)};return r(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;r(e=t)}else i()}}e.exports=function(e,t){(t=t||{}).singleton||"boolean"==typeof t.singleton||(t.singleton=i());var n=l(e=e||[],t);return function(e){if(e=e||[],"[object Array]"===Object.prototype.toString.call(e)){for(var r=0;r<n.length;r++){var i=a(n[r]);s[i].references--}for(var o=l(e,t),d=0;d<n.length;d++){var c=a(n[d]);0===s[c].references&&(s[c].updater(),s.splice(c,1))}n=o}}}},function(e,t,n){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n=e(t);return t[2]?"@media ".concat(t[2]," {").concat(n,"}"):n})).join("")},t.i=function(e,n,r){"string"==typeof e&&(e=[[null,e,""]]);var i={};if(r)for(var o=0;o<this.length;o++){var s=this[o][0];null!=s&&(i[s]=!0)}for(var a=0;a<e.length;a++){var l=[].concat(e[a]);r&&i[l[0]]||(n&&(l[2]?l[2]="".concat(n," and ").concat(l[2]):l[2]=n),t.push(l))}},t}},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return l}));var r,i=n(2),o=n(1),s=(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=function(t){function n(e){void 0===e&&(e=Object());var n=t.call(this)||this;return n.dom=document.createElement("div"),n.dom.setAttribute("class","art-main"),n.options=Object.assign({},i.a,e),o.b.createdArt(n),n}return s(n,t),n.prototype.mount=function(e){return this.rootContainer=document.querySelector(e),this.rootContainer.appendChild(this.dom),o.b.mountArt(this),this},n.prototype.exportAPI=function(e,t){this[e]=t},n.prototype.unmount=function(){o.b.unmountArt(this)},n.version=void 0===e.env.ART_VERSION?"dev":e.env.ART_VERSION,n.use=o.b.use,n}(o.a);t.b=a;var l={install:function(e,t){window.ArtText=a}}}).call(this,n(9))},function(e,t,n){"use strict";var r=n(4),i=n.n(r)()((function(e){return e[1]}));i.push([e.i,"",""]),t.a=i},function(e,t,n){"use strict";var r=n(4),i=n.n(r)()((function(e){return e[1]}));i.push([e.i,".art-editor {\r\n    box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);\r\n    padding: 30px 25px;\r\n    border-radius: 4px;\r\n    background-color: #fff;\r\n}",""]),t.a=i},function(e,t,n){"use strict";var r=n(4),i=n.n(r)()((function(e){return e[1]}));i.push([e.i,'.art-render-art {\r\n    outline: none;\r\n    white-space: pre-wrap;\r\n    word-break: break-all\r\n}\r\n\r\n.art-hide {\r\n    display: inline-block;\r\n    width: 0;\r\n    height: 0;\r\n    overflow: hidden;\r\n    vertical-align: middle;\r\n}\r\n\r\n.art-display-none {\r\n    display: none;\r\n}\r\n\r\n.art-show {\r\n    color: #ccc;\r\n}\r\n\r\n.art-show-math {\r\n    top: 26px;\r\n    width: max-content;\r\n    z-index: 5;\r\n    position: absolute;\r\n    padding: 13px 25px;\r\n    background: #fff;\r\n    box-shadow: rgba(0, 0, 0, 0.1) 0px 2px 12px 0px;\r\n}\r\n\r\n.art-editor li>p>input {\r\n    position: absolute;\r\n    margin-left: -1.15em;\r\n    margin-top: 0.45em;\r\n}\r\n\r\n.art-buttonTool-hover {\r\n    font-size: 13px;\r\n    font-weight: 600;\r\n    margin-left: 4px;\r\n    cursor: pointer;\r\n    border: none;\r\n    outline: none;\r\n    padding: 0px 4px;\r\n    border: 1px solid #9a9a9a00;\r\n    background: #fff;\r\n}\r\n\r\n.art-buttonTool-hover:hover {\r\n    border-color: #aaaa;\r\n    background: #efefef;\r\n}\r\n\r\n.art-codeBlockBottomTool {\r\n    width: 100%;\r\n    text-align: center;\r\n}\r\n\r\n.art-codeBlockTool {\r\n    width: 100%;\r\n    font-weight: 600;\r\n    visibility: visible;\r\n    display: flex;\r\n}\r\n\r\n.art-floatTool {\r\n    width: 180px;\r\n    list-style: none;\r\n    position: fixed;\r\n    top: 10px;\r\n    left: 10px;\r\n    box-shadow: rgba(0, 0, 0, 0.1) 0px 2px 12px 0px;\r\n    background: #fff;\r\n    padding: 8px 0 6px\r\n}\r\n\r\n.art-floatTool-li {\r\n    padding: 6px 25px;\r\n    cursor: pointer;\r\n    font-weight: 400;\r\n}\r\n\r\n.art-floatTool li:hover {\r\n    background-color: #f4f4f4;\r\n    color: #1abc9c;\r\n    font-weight: 600;\r\n}\r\n\r\n/**浮动工具 分割线 */\r\n.art-divider {\r\n    margin: 4px 0;\r\n    background: #e5e5e5;\r\n    padding: 1px 0 0;\r\n}\r\n\r\n.art-toc {\r\n    padding: 6px 15px;\r\n    margin: 0 0 15px;\r\n    font-weight: 400;\r\n    border: 1px dashed #9990;\r\n}\r\n\r\n.art-toc p {\r\n    margin-bottom: 2px\r\n}\r\n\r\n.art-toc a {\r\n    border-bottom: none;\r\n    color: #4183c4\r\n}\r\n\r\n.art-toc-h2 {\r\n    margin-left: 2em\r\n}\r\n\r\n.art-toc-h3 {\r\n    margin-left: 4em\r\n}\r\n\r\n.art-toc-h4 {\r\n    margin-left: 6em\r\n}\r\n\r\n.art-toc-h5 {\r\n    margin-left: 8em\r\n}\r\n\r\n.art-toc-h6 {\r\n    margin-left: 10em\r\n}\r\n\r\n.art-tocTool {\r\n    width: 100%;\r\n    position: relative;\r\n}\r\n\r\n.markdown-body h1::before, .markdown-body h2::before, .markdown-body h3::before, .markdown-body h4::before, .markdown-body h5::before, .markdown-body h6::before {\r\n    position: absolute;\r\n    color: rgba(88, 96, 105, 0.36);\r\n    font-weight: 400;\r\n    font-size: 10px;\r\n    margin-left: -2em;\r\n    margin-top: 0.em;\r\n}\r\n\r\n.markdown-body h1::before {\r\n    content: "H1";\r\n}\r\n\r\n.markdown-body h2::before {\r\n    content: "H2";\r\n}\r\n\r\n.markdown-body h3::before {\r\n    content: "H3";\r\n}\r\n\r\n.markdown-body h4::before {\r\n    content: "H4";\r\n}\r\n\r\n.markdown-body h5::before {\r\n    content: "H5";\r\n}\r\n\r\n.markdown-body h6::before {\r\n    content: "H6";\r\n}\r\n\r\n.art-md-item-checkbox {\r\n    position: relative;\r\n    list-style-type: none;\r\n}\r\n\r\n.art-md-item-checkbox>input {\r\n    position: absolute;\r\n    top: 0;\r\n    left: 0;\r\n    margin-left: -1.25em;\r\n    margin-top: calc(1em - 7px);\r\n    border: none;\r\n}\r\n\r\n.art-md-Table table {\r\n    width: 100%;\r\n}\r\n\r\n.art-md-MathBlock, .art-md-HtmlBlock {\r\n    margin: 12px 0 8px;\r\n}\r\n\r\n.art-md-html-block-main::before, .art-md-math-block-main::before {\r\n    font-family: "Source Sans Pro", "Helvetica Neue", Arial, sans-serif;\r\n    position: absolute;\r\n    top: -20px;\r\n    right: 0;\r\n    background-color: #f6f8fa;\r\n    color: #777;\r\n    text-align: right;\r\n    font-size: 0.6em;\r\n    padding: 8px 20px 0;\r\n    line-height: 15px;\r\n    height: 15px;\r\n}\r\n\r\n.art-md-math-block-main {\r\n    position: relative;\r\n    background-color: #f6f8fa;\r\n    border-radius: 2px;\r\n    margin-bottom: 5px;\r\n}\r\n\r\n.art-md-html-block-main, .art-md-math-block-main pre {\r\n    overflow-x: auto;\r\n    padding: 0.1em 1em;\r\n    margin: 0;\r\n    font-size: 14px;\r\n}\r\n\r\n.art-md-math-block-main::before {\r\n    content: "公式";\r\n}\r\n\r\n.art-md-HtmlBlock {\r\n    position: relative;\r\n}\r\n\r\n.art-md-HtmlBlock pre {\r\n    position: static;\r\n}\r\n\r\n.art-md-html-block-main::before {\r\n    content: "HTML";\r\n}\r\n\r\n.art-md-DefLink {\r\n    margin-top: 0;\r\n    margin-bottom: 16px;\r\n}\r\n\r\n.art-md-DefLink-name {\r\n    font-weight: 700;\r\n}\r\n\r\n.art-md-DefLink-title, .art-md-DefLink-url {\r\n    color: #c7c7cc;\r\n}\r\n\r\n.art-emptyline {\r\n    display: block;\r\n}',""]),t.a=i},function(e,t){var n,r,i=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(e){if(n===setTimeout)return setTimeout(e,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(e){n=o}try{r="function"==typeof clearTimeout?clearTimeout:s}catch(e){r=s}}();var l,d=[],c=!1,h=-1;function p(){c&&l&&(c=!1,l.length?d=l.concat(d):h=-1,d.length&&u())}function u(){if(!c){var e=a(p);c=!0;for(var t=d.length;t;){for(l=d,d=[];++h<t;)l&&l[h].run();h=-1,t=d.length}l=null,c=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===s||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function m(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];d.push(new f(e,t)),1!==d.length||c||a(u)},f.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=m,i.addListener=m,i.once=m,i.off=m,i.removeListener=m,i.removeAllListeners=m,i.emit=m,i.prependListener=m,i.prependOnceListener=m,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,n){"use strict";n.r(t);var r=n(5),i=n(1),o=n(0),s=n(3),a=n.n(s),l=n(7),d={insert:"head",singleton:!1},c=(a()(l.a,d),l.a.locals,function(){function e(e){this.artText=e,this.dom=document.createElement("div"),this.dom.setAttribute("class","art-editor markdown-body"),this.artText.dom.appendChild(this.dom),this.fileInfo={},this.renders={},this.artText.exportAPI("openFile",this.getFile)}return e.prototype.init=function(){this.defaultRender&&(this.runRender=this.defaultRender),this.runRender.open(),this.runRender.setMd(this.artText.options.defaultMd)},e.prototype.addRender=function(e,t){this.renders[e]=t,this.dom.appendChild(t.createDom()),this.artText.get("$eventCenter").waitOnceEmit("@switchRenderButton-addRender",this.renders[e].abbrName,e)},e.prototype.openFile=function(e,t){void 0===e&&(e={}),void 0===t&&(t=null),this.fileInfo=Object.assign({name:null,id:null,defaultMd:""},e),this.switchRender(t)},e.prototype.getFile=function(e){return void 0===e&&(e=null),"fileInfo"==e?this.fileInfo:"md"==e?this.runRender.getMd():(this.fileInfo.markdown=this.runRender.getMd(),this.fileInfo)},e.prototype.switchRender=function(e){var t,n=null;if(null==e)n=this.defaultRender,t=this.fileInfo.defaultMd;else{if(this.runRender==this.renders[e])return null;n=this.renders[e],t=this.runRender.getMd()}this.runRender.close(),n.open(),n.setMd(t),this.runRender=n},e}()),h={install:function(e,t){t.container.bind("$editor",c,[{get:"art"}],!0)},created:function(e,t){e.get("$editor")},mount:function(e,t){e.get("$editor").init()}},p=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var o=arguments[t],s=0,a=o.length;s<a;s++,i++)r[i]=o[s];return r},u=function(){function e(e){this.artText=e,this.events=new Map,this.waitEvents=new Map,this.listeners={},this.domID=0;var t=this;this.attachDOMEvent(this.artText.dom,"art-event",(function(e){return t.artEvent(e)}))}return e.prototype.artEvent=function(e){this.emit(e.detail.type,e.detail)},Object.defineProperty(e.prototype,"eventId",{get:function(){return"eventId-"+this.domID++},enumerable:!1,configurable:!0}),e.prototype.attachDOMEvent=function(e,t,n,r){if(void 0===r&&(r=!1),this.checkHasBind(e,t,n,r))return null;var i=this.eventId;return e.addEventListener(t,n,r),this.events.set(i,{target:e,type:t,listener:n,options:r}),i},e.prototype.detachDOMEvent=function(e){if(!e)return!1;var t=this.events.get(e);if(null!=t){var n=t.target,r=t.type,i=t.listener,o=t.options;n.removeEventListener(r,i,o),this.events.delete(e)}return!0},e.prototype.detachAllDomEvent=function(){for(var e in this.events)this.detachDOMEvent(e)},e.prototype.checkHasBind=function(e,t,n,r){for(var i in void 0===r&&(r=!1),this.events){var o=this.events[i],s=o.target,a=o.type,l=o.listener,d=o.options;if(s===e&&a===t&&l===n&&d===r)return!0}return!1},e.prototype.subscribe=function(e,t,n){void 0===n&&(n=!1);var r=this.listeners[e],i={listener:t,once:n};r&&Array.isArray(r)?r.push(i):this.listeners[e]=[i],this.waitEvents.has(e)&&(this.emit.apply(this,p([e],this.waitEvents.get(e))),this.waitEvents.delete(e))},e.prototype.on=function(e,t){this.subscribe(e,t)},e.prototype.once=function(e,t){this.subscribe(e,t,!0)},e.prototype.emit=function(e){for(var t=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var i=this.listeners[e];return!(!i||!Array.isArray(i))&&(i.forEach((function(r){var i=r.listener,o=r.once;i.apply(void 0,n),o&&t.off(e,i)})),!0)},e.prototype.waitOnceEmit=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];this.emit.apply(this,p([e],t))||this.waitEvents.set(e,t)},e.prototype.off=function(e,t){var n,r=this.listeners[e];Array.isArray(r)&&-1!=(n=r.findIndex((function(e){return e.listener===t})))&&r.splice(n,1)},e}(),f={install:function(e,t){t.container.bind("$eventCenter",u,[{get:"art"}],!0)},created:function(e,t){e.get("$eventCenter")}},m=function(){function e(){this.rowNode=null,this.rowAnchorOffset=null}return e.prototype.setRowNode=function(e,t){if(null===this.rowNode)switch(e.nodeName){case"H1":case"H2":case"H3":case"H4":case"H5":case"H6":case"P":case"TH":case"TD":case"PRE":case"HR":return this.rowNode=e,this.rowNodeAnchorOffset=t,!0;case"BLOCKQUOTE":if(0===t)return this.rowNode=e.firstChild,this.rowNodeAnchorOffset=0,!0;break;case"DIV":if(o.b.hasClass(e,"art-md-Hr"))return this.rowNode=e.firstChild,this.rowNodeAnchorOffset=0,!0;if(o.b.hasClass(e,"art-md-DefLink"))return this.rowNode=e,this.rowNodeAnchorOffset=t,!0;break;case"LI":if(0===t)return"INPUT"===e.firstChild.nodeName&&e.firstChild.nextSibling||e.firstChild.nextSibling?this.rowNode=e.firstChild.nextSibling:this.rowNode=e,this.rowNodeAnchorOffset=0,!0}return!1},e}(),g=function(){function e(e){this.mountDom=e,this.pos=null}return e.getNodeAndOffset=function(t,n){for(t=t.firstChild;t;){if(t instanceof Text){if(!(n>t.data.length))return[t,n];n-=t.data.length,console.log(n,t.data.length)}else{var r=e.getNodeAndOffset(t,n);if(r[0])return r;n=r[1]}t=t.nextSibling}return[null,n]},e.setCursor=function(t,n){if(null==t&&!t)return!1;var r=e.sel.getRangeAt(0).cloneRange();r.setStart(t,n),r.collapse(!0),e.sel.removeAllRanges(),e.sel.addRange(r)},e.prototype.getSelection=function(){var t=e.sel,n=t.anchorNode,r=t.anchorOffset,i=t.focusNode,s=t.focusOffset;if(n&&i&&n!=this.mountDom){this.pos=new m,this.pos.selection=e.sel;var a=n,l=r;for(this.pos.setRowNode(a,l);a.parentNode!=this.mountDom;){if(o.b.hasClass(a,"art-shield"))return this.pos=null,this.pos;for(this.pos.setRowNode(a,l);a.previousSibling;)a=a.previousSibling,o.b.hasClass(a,"art-shield")||(l+=a.textContent.length),this.pos.setRowNode(a,l);a=a.parentNode,this.pos.setRowNode(a,l)}this.pos.inAnchorOffset=l;for(var d=-1,c=0;c<this.mountDom.childNodes.length;c++)if(this.mountDom.childNodes[c]===a){d=c;break}this.pos.rowAnchorOffset=d;for(var h=i,p=s;h.parentNode!==this.mountDom;){for(;h.previousSibling;)h=h.previousSibling,o.b.hasClass(h,"art-shield")||(p+=h.textContent.length);h=h.parentNode}this.pos.inFocusOffset=p;var u=-1;for(c=0;c<this.mountDom.childNodes.length;c++)if(this.mountDom.childNodes[c]===h){u=c;break}this.pos.rowFocusOffset=u}else this.pos=null;return this.pos},e.prototype.searchNode=function(e,t){if(1==e.childNodes.length&&"#text"==e.childNodes[0].nodeName){if(t<e.childNodes[0].textContent.length)return[e.childNodes[0],t];if(t===e.childNodes[0].textContent.length){if(0===this.pos.rowNodeAnchorOffset){for(;e;){if(e.nextSibling){e=e.nextSibling;break}e=e.parentNode}return"LI"===e.nodeName&&(e="INPUT"===e.firstChild.nodeName&&e.firstChild.nextSibling?e.firstChild.nextSibling:e.firstChild),[e,0]}return[e.childNodes[0],t]}t-=e.textContent.length}else for(var n=0;n<e.childNodes.length;n++)if(!o.b.hasClass(e.childNodes[n],"art-shield")){if(!(e.childNodes[n].textContent.length<t)){if("#text"===e.childNodes[n].nodeName){if(0===this.pos.rowNodeAnchorOffset){for(;e;){if(e.nextSibling){e=e.nextSibling;break}e=e.parentNode}return[e,0]}return[e.childNodes[n],t]}return this.searchNode(e.childNodes[n],t)}t-=e.childNodes[n].textContent.length}return 1==t&&e.nextSibling?[e.nextSibling,0]:null},e.prototype.setTool=function(e){for(var t=this.mountDom.getElementsByClassName("art-tocTool"),n=0;n<t.length;n++)t[n].style.visibility="hidden",t[n].nextSibling.style.borderColor="#9990";t=this.mountDom.getElementsByClassName("art-display");for(n=0;n<t.length;n++)o.b.hasClass(t[n],"art-md-html-block-main")?e!==t[n].parentElement&&(t[n].nextSibling.style.display="block",t[n].classList.replace("art-display","art-display-none")):o.b.hasClass(e,"art-md-MathBlock")?e!==t[n].parentElement&&t[n].classList.replace("art-display","art-display-none"):t[n].classList.replace("art-display","art-display-none");if(o.b.hasClass(e,"art-shield"))return!!o.b.hasClass(e,"art-toc")&&(e.previousSibling&&o.b.hasClass(e.previousSibling,"art-tocTool")&&(e.previousSibling.style.visibility="visible",e.style.borderColor="#999"),!0);t=this.mountDom.getElementsByClassName("art-codeBlockTool");for(n=0;n<t.length;n++)t[n].style.visibility="hidden";t=this.mountDom.getElementsByClassName("art-tableTool");for(n=0;n<t.length;n++)t[n].style.visibility="hidden";if(ft.plugins.flowchart||ft.plugins.mermaid){t=this.mountDom.getElementsByClassName("art-codeBlockBottomTool");for(n=0;n<t.length;n++)""===t[n].innerHTML||(e.lastChild==t[n]?(t[n].style.border="1px solid #999",t[n].previousSibling.style.display="inherit"):(t[n].style.border="inherit",t[n].previousSibling.style.display="none"))}return(o.b.hasClass(e,"art-md-CodeBlock")||!!o.b.hasClass(e,"art-md-Table"))&&(e.firstChild.style.visibility="visible",!0)},e.prototype.setSelection=function(t){if(void 0===t&&(t=void 0),null!=typeof t&&t||(t=this.pos),!t)return!1;for(var n=this.mountDom.getElementsByClassName("art-show"),r=n.length-1;r>=0;r--){d=(d=n[r].getAttribute("class")).replace("art-show","art-hide"),n[r].setAttribute("class",d)}if(this.pos&&this.pos.selection.isCollapsed){var i=null,s=this.mountDom.childNodes[this.pos.rowFocusOffset],a=this.pos.inAnchorOffset;if(this.setTool(s),console.log(this.pos),o.b.hasClass(s,"art-shield"))return null;if(i=o.b.hasClass(s,"art-md-Hr")?[s.firstChild,0]:this.searchNode(s,a),console.log(i),null===i)return null;var l=this.mountDom.getElementsByClassName("art-show-math");for(r=l.length-1;r>=0;r--){d=(d=l[r].getAttribute("class")).replace("art-show-math",""),l[r].setAttribute("class",d)}if("#text"==i[0].nodeName&&o.b.hasClass(i[0].parentNode,"art-md-math")&&i[0].parentNode.previousSibling.childNodes[0])(null==(d=i[0].parentNode.previousSibling.childNodes[0].getAttribute("class"))||d.indexOf("art-show-math")<0)&&(d+=" art-show-math",i[0].parentNode.previousSibling.childNodes[0].setAttribute("class",d));i[0]===this.pos.selection.anchorNode&&i[1]===this.pos.selection.anchorOffset||e.setCursor(i[0],i[1]);var d,c=i[0].parentNode;if(c&&o.b.hasClass(c,"art-hide")?c.previousSibling&&o.b.hasClass(c.previousSibling,"art-text-double")?c=c.previousSibling:c.nextSibling&&o.b.hasClass(c.nextSibling,"art-text-double")?c=c.nextSibling:c&&o.b.hasClass(c,"art-text-parent")&&(c=c.parentElement):c&&o.b.hasClass(c,"art-text-parent")&&(c=c.parentElement),c&&o.b.hasClass(c,"art-text-double"))d=(d=c.nextSibling.getAttribute("class")).replace("art-hide","art-show"),c.nextSibling.setAttribute("class",d),d=(d=c.previousSibling.getAttribute("class")).replace("art-hide","art-show"),c.previousSibling.setAttribute("class",d);if("#text"===i[0].nodeName&&o.b.hasClass(i[0].parentNode,"art-hide"))d=(d=i[0].parentElement.getAttribute("class")).replace("art-hide","art-show"),i[0].parentElement.setAttribute("class",d)}},e.prototype.moveCursor=function(e){switch(e){case"ArrowRight":default:return!1}return this.setSelection(),!0},e.sel=window.getSelection(),e}();function b(e){e.addCustomizeEvent("art-ShortcutKey-Control+s",(function(){e.artRender.artText.get("$eventCenter").emit("art-save")})),e.addCustomizeEvent("art-ShortcutKey-Control+b",(function(){e.artRender.artText})),e.addCustomizeEvent("art-ShortcutKey-Control+i",(function(){e.artRender.artText})),e.addCustomizeEvent("art-ShortcutKey-Control+z",(function(){e.artRender.operation.undo()}))}function v(){this.parentNode.nextSibling.childNodes[0].className="lang-"+this.value}function y(e,t){void 0===t&&(t="start"),e.setAttribute("class","art-meta art-shield art-mathBlockTool"),e.setAttribute("contenteditable","false");var n=document.createElement("span");n.style.letterSpacing="1.5px",n.style.marginLeft="8px",n.style.color="#aaa",n.style.fontSize="14px",n.innerHTML="$$",e.appendChild(n)}var C=function(){function e(e,t){void 0===t&&(t=!1),this.current=e,this.root=e,this.entering=!0,this.selfFalg=t}return e.prototype.next=function(){var e=this.current,t=this.entering;if(null===e)return null;var n=x.isContainer(e);return t&&n?e.firstChild?(this.current=e.firstChild,this.entering=!0):this.entering=!1:e===this.root?this.current=null:null===e.next?(this.current=e.parent,this.entering=!1):(this.current=e.next,this.entering=!0),this.selfFalg&&e===this.root?this.next():{entering:t,node:e}},e.prototype.resumeAt=function(e,t){this.current=e,this.entering=!0===t},e}(),x=function(){function e(e,t){void 0===t&&(t=null),this._type=e,this._parent=null,this._firstChild=null,this._lastChild=null,this._prev=null,this._next=null,this._sourcepos=t,this._lastLineBlank=!1,this._lastLineChecked=!1,this._open=!0,this._string_content=null,this._literal=null,this._listData={type:"",tight:"",start:null,delimiter:"",markerOffset:"",padding:"",bulletChar:""},this._info=null,this._destination=null,this._title=null,this._isFenced=!1,this._fenceChar=null,this._fenceLength=0,this._fenceOffset=null,this._level=null,this._onEnter=null,this._onExit=null,this.attrs=new Map,this.dom=null}return Object.defineProperty(e.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"firstChild",{get:function(){return this._firstChild},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastChild",{get:function(){return this._lastChild},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"next",{get:function(){return this._next},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"prev",{get:function(){return this._prev},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sourcepos",{get:function(){return this._sourcepos},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"listType",{get:function(){return this._listData.type},set:function(e){this._listData.type=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"listTight",{get:function(){return this._listData.tight},set:function(e){this._listData.tight=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"listStart",{get:function(){return this._listData.start},set:function(e){this._listData.start=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"listDelimiter",{get:function(){return this._listData.delimiter},set:function(e){this._listData.delimiter=e},enumerable:!1,configurable:!0}),e.prototype.setDom=function(){return null==this.dom?this.newDom():null},e.prototype.newDom=function(){var t,n,r;switch(this._type){case"text":return"link"===this.parent._type&&this.parent.dom.setAttribute("alt",this._literal),this.dom=new Text(this._literal),null;case"softbreak":return this.dom=document.createElement("span"),this.setAttrs(),this.dom.classList.add("art-md-softbreak"),this.dom.appendChild(new Text("\n")),null;case"code":return this.dom=document.createElement("code"),this.setAttrs(),this.dom.innerHTML=this._literal,null;case"linebreak":return this.dom=document.createElement("br"),null;case"thematic_break":return this.dom=document.createElement("div"),this.dom.setAttribute("class","art-md-Hr"),this.dom.appendChild(document.createElement("hr")),null;case"art_tool":if(this.dom=document.createElement("div"),"math"===this.attrs.get("--tool")&&(this.dom=document.createElement("span"),this.dom.setAttribute("contenteditable","false"),this.dom.setAttribute("class","art-shield"),this.dom.style.position="relative",this.dom.onclick=function(){g.setCursor(this.nextSibling,0)},ft.plugins.katex)){var i=this.dom,o=this.attrs.get("--math"),s=this._next.attrs.get("class");return s+=" art-hide",this._next.attrs.set("class",s),function(){return ft.plugins.katex(i,o)}}return null;case"link":this.dom=document.createElement("a"),this.dom.href=this._destination,this._title&&(this.dom.title=this._title);break;case"image":return this.dom=document.createElement("img"),this.dom.setAttribute("src",this._destination),this._title&&(this.dom.title=this._title),void this.setAttrs();case"code_block":this.dom=document.createElement("div"),this.dom.setAttribute("class","art-md-CodeBlock");var a,l=this._info?this._info.split(/\s+/):[],d="",c=document.createElement("code");l.length>0&&l[0].length>0&&(c.setAttribute("class","lang-"+l[0]),d=l[0]),function(e,t){void 0===t&&(t=""),e.setAttribute("class","art-meta art-shield art-codeBlockTool"),e.setAttribute("style","visibility:hidden"),e.setAttribute("contenteditable","false");var n=document.createElement("span");n.style.letterSpacing="4px",n.style.color="#aaa",n.style.position="relative",n.style.top="3px",n.innerHTML="```";var r=document.createElement("input");r.setAttribute("style","font-size:14px;letter-spacing:1px;font-weight: 600;padding: 1px 2px;border: none;outline: none;color: #1abc9c;display: flex;flex-direction: column;flex: 1 1 0%;"),r.title="设置代码语言",r.value=t,r.onchange=v,e.appendChild(n),e.appendChild(r)}(a=document.createElement("div"),d),this.dom.appendChild(a),(a=document.createElement("pre")).style.outline="none",a.appendChild(c),this.dom.appendChild(a);var h=this._literal;switch(ft.plugins.hljs?ft.plugins.hljs(c,h,d):c.innerHTML=h,d){case"flow":if((a=document.createElement("div")).setAttribute("contenteditable","false"),a.setAttribute("class","art-meta art-shield art-codeBlockBottomTool"),this.dom.appendChild(a),ft.plugins.flowchart){return function(){return ft.plugins.flowchart(a,h)}}break;case"mermaid":if((a=document.createElement("div")).setAttribute("contenteditable","false"),a.setAttribute("class","art-meta art-shield art-codeBlockBottomTool"),this.dom.appendChild(a),ft.plugins.mermaid){return function(){return ft.plugins.mermaid(a,h)}}}break;case"math":this.dom=document.createElement("span");break;case"math_block":this.dom=document.createElement("div"),this.dom.setAttribute("class","art-md-MathBlock");var p=document.createElement("div");p.setAttribute("class","art-md-math-block-main");var u=document.createElement("div");y(u,"start"),p.appendChild(u);var f=document.createElement("pre");f.innerHTML=this._literal,f.onblur=function(){if(ft.plugins.katex){var e=this.innerText;ft.plugins.katex(this.parentElement.nextElementSibling,e),this.parentElement.style.display="none"}},p.appendChild(f),y(u=document.createElement("div"),"end"),p.appendChild(u),this.dom.appendChild(p);var m=document.createElement("div");if(m.setAttribute("contenteditable","false"),m.style.textAlign="center",m.onclick=function(){this.previousSibling.classList.replace("art-display-none","art-display"),g.setCursor(this.previousSibling.childNodes[1].firstChild,0)},ft.plugins.katex){p.classList.add("art-display-none");var b=this._literal;ft.plugins.katex(m,b)}else p.style.display="block";this.dom.appendChild(m);break;case"item_checkbox":this.dom=document.createElement("input"),this.setAttrs();break;case"html_inline":this.dom=document.createElement("span"),this.setAttrs(),this.dom.classList.add("art-md-html-inline"),this.dom.style.color="#999",this.dom.innerText=this._literal;break;case"html_block":this.dom=document.createElement("div"),this.dom.setAttribute("class","art-md-HtmlBlock"),(f=document.createElement("pre")).setAttribute("class","art-md-html-block-main art-display-none");var C=new Text(this._literal);f.appendChild(C),this.dom.appendChild(f),(m=document.createElement("div")).setAttribute("contenteditable","false"),m.style.padding="15px 0 10px",m.onclick=function(){this.style.display="none",this.previousSibling.classList.replace("art-display-none","art-display"),g.setCursor(this.previousSibling,0)},m.innerHTML=this._literal,this.dom.appendChild(m);break;case"table":this.dom=document.createElement("div"),this.dom.setAttribute("class","art-md-Table"),a=document.createElement("div"),this.dom.appendChild(a),new w(a,this),a=document.createElement("table"),this.dom.appendChild(a),this.attrs.forEach((function(e,t){a.setAttribute(t,e)}));for(var x=this.firstChild,_=void 0;x;)_=x.newDom(),a.appendChild(x.dom),_&&_(),x=x.next;return null;case"th":case"td":this.dom=document.createElement(this._type),(null===(t=this._info)||void 0===t?void 0:t.style)&&(this.dom.style.textAlign=null===(n=this._info)||void 0===n?void 0:n.style);break;case"def_link":this.dom=document.createElement("div"),this.dom.setAttribute("class","art-md-DefLink");var k=document.createElement("span");return this.dom.appendChild(k),k.setAttribute("class","art-md-DefLink-name"),k.innerHTML='<span style=" margin-right: 8px;color: #c7c7c7">[</span>'+this._literal+'<span style="margin-left: 8px;color: #c7c7c7">]: </span>',k=document.createElement("span"),this.dom.appendChild(k),k.setAttribute("class","art-md-DefLink-url"),k.innerText=this._destination,this._title&&(k=document.createElement("span"),this.dom.appendChild(k),k.setAttribute("class","art-md-DefLink-title"),k.innerHTML='<span style=" margin-right: 3px;color: #c7c7c7"> "</span>'+this._title+'<span style="margin-left: 3px;color: #c7c7c7">"</span>'),null;default:switch(this._type){case"heading":r="h"+this._level;break;case"paragraph":r="p";break;case"delete":r="del";break;case"emph":r="em";break;case"block_quote":r="blockquote";break;case"list":r="bullet"===this.listType?"ul":"ol";break;case"item":r="li";break;default:r=this._type}this.dom=document.createElement(r)}if(e.isContainer(this)){this.setAttrs();for(x=this.firstChild,_=void 0;x;)_=x.newDom(),this.dom.appendChild(x.dom),_&&_(),x=x.next}return null},e.prototype.setAttrs=function(){var e=this;this.attrs.forEach((function(t,n){e.dom.setAttribute(n,t)}))},e.isBlock=function(e){switch(e._type){case"document":case"block_quote":case"list":case"paragraph":case"heading":case"custom_block":return!0;default:return!1}},e.isContainer=function(e){switch(e._type){case"document":case"block_quote":case"table":case"thead":case"tbody":case"tr":case"th":case"td":case"list":case"item":case"paragraph":case"heading":case"emph":case"strong":case"link":case"image":case"span":case"delete":case"custom_inline":case"custom_block":case"math":return!0;default:return!1}},e.prototype.appendChild=function(e){e.unlink(),e._parent=this,this._lastChild?(this._lastChild._next=e,e._prev=this._lastChild,this._lastChild=e):(this._firstChild=e,this._lastChild=e)},e.prototype.prependChild=function(e){e.unlink(),e._parent=this,this._firstChild?(this._firstChild._prev=e,e._next=this._firstChild,this._firstChild=e):(this._firstChild=e,this._lastChild=e)},e.prototype.unlink=function(){this._prev?this._prev._next=this._next:this._parent&&(this._parent._firstChild=this._next),this._next?this._next._prev=this._prev:this._parent&&(this._parent._lastChild=this._prev),this._parent=null,this._next=null,this._prev=null},e.prototype.replace=function(e){e.unlink(),e._parent=this._parent,this._prev?(e._prev=this._prev,this._prev._next=e):e._parent._firstChild=e,this._next?(e._next=this._next,this._next._prev=e):e._parent._lastChild=e,this._parent=null,this._next=null,this._prev=null},e.prototype.insertAfter=function(e){e.unlink(),e._next=this._next,e._next&&(e._next._prev=e),e._prev=this,this._next=e,e._parent=this._parent,e._next||(e._parent._lastChild=e)},e.prototype.insertBefore=function(e){e.unlink(),e._prev=this._prev,e._prev&&(e._prev._next=e),e._next=this,this._prev=e,e._parent=this._parent,e._prev||(e._parent._firstChild=e)},e.prototype.walker=function(e){return new C(this,e)},e.prototype.getMd=function(){var t="",n=this._firstChild;switch(this._type){case"html_inline":case"text":return this._literal;case"html_block":return this._literal+"\n";case"softbreak":return"\n";case"thematic_break":return this.attrs.get("art-marker")+"\n";case"code":return this._literal;case"code_block":if(this.dom){var r=this.dom.childNodes[1].firstChild,i="",o=r.className.match(/lang-(.*?)(\s|$)/g);o&&(o.forEach((function(e){return i+=e.substring(5)})),this._info=i)}return t+="```"+this._info+"\n",t+=this._literal,t+="```\n";case"math_block":return t+="$$\n",t+=this._literal,t+="$$\n";case"table":var s=this.firstChild.firstChild.firstChild,a="",l=void 0;for(t+="|",a+="|";s;){switch(t+=s.getMd()+"|",s.dom.style.textAlign){case"center":a+=":---:|";break;case"left":a+=":---|";break;case"right":a+="---:|";break;default:a+="---|"}s=s.next}for(t+="\n"+a+"\n",s=this.lastChild.firstChild;s;){for(l=s.firstChild,t+="|";l;)t+=l.getMd()+"|",l=l.next;t+="\n",s=s.next}return t;case"item":var d=void 0,c="",h=!0;for(s=this.parent;s;){if("list"===s.type)"ordered"===s._listData.type?c+="   ":c+="  ";else if("item"!==s.type)break;s=s.parent}for("ordered"===this._listData.type?t+=this._listData.start+". ":t+=this._listData.bulletChar+" ";n;){switch(n.type){case"list":case"block_quote":case"paragraph":for(var p=(d=n.getMd()).substring(0,d.length-1).split("\n"),u=0;u<p.length;u++)h?(t+=p[u]+"\n",h=!1):t+=c+p[u]+"\n";break;default:t+=n.getMd()}n=n._next}return t;case"item_checkbox":return this.dom.checked?t+="[x] ":t+="[ ] ",t;case"block_quote":for(;n;){switch(n.type){case"list":case"block_quote":case"paragraph":(p=(d=n.getMd()).substring(0,d.length-1).split("\n")).forEach((function(e){return t+="> "+e+"\n"}));break;default:t+="> "+n.getMd()}n=n._next}return t;case"def_link":return t="["+this._literal+"]: "+this._destination,this._title&&(t+=' "'+this._title+'"'),t+="\n";case"image":return t;default:if(e.isContainer(this))for(;n;)t+=n.getMd(),n=n._next;return"list"===this.type?"document"===this.parent.type&&(t+="\n"):e.isBlock(this)&&(t+="\n"),t}},e.prototype.getText=function(){if(this.attrs.has("class")&&/art\-meta/.test(this.attrs.get("class")))return"";if("text"===this._type)return this._literal;for(var e="",t=this._firstChild;t;)e+=t.getText(),t=t._next;return e},e.prototype.isEqual=function(e){if(e.type!=this._type)return!1;switch(this._type){case"text":if(this._literal!=e._literal)return!1}return!0},e}(),_=x;var w=function(){function e(e,t){this.tableNode=t,this.rootDom=e,e.innerHTML="",e.setAttribute("class","art-shield art-tableTool"),e.setAttribute("contenteditable","false"),e.setAttribute("style","width:100%;visibility:hidden;font-size:14px;position:relative;margin-bottom: 2px;"),e.appendChild(this.createAdjustSpan()),e.appendChild(this.createAlignSpan()),e.appendChild(this.createDelButton()),e.appendChild(this.createMoreButton())}return e.prototype.createAlignSpan=function(){var e=document.createElement("button");e.setAttribute("class","art-buttonTool-hover"),e.onclick=this.align("left"),e.innerHTML="左";var t=document.createElement("button");t.setAttribute("class","art-buttonTool-hover"),t.onclick=this.align("center"),t.innerHTML="中";var n=document.createElement("button");n.setAttribute("class","art-buttonTool-hover"),n.onclick=this.align("right"),n.innerHTML="右";var r=document.createElement("span");return r.appendChild(e),r.appendChild(t),r.appendChild(n),r},e.prototype.createAdjustSpan=function(){var e=document.createElement("input");e.setAttribute("style","width:35px;margin:0 7px;;font-size:14px;font-weight: 600;color: #1abc9c;border: none;outline: none;"),e.title="调整行";var t=document.createElement("input");t.setAttribute("style","width:35px;font-size:14px;font-weight: 600;color: #1abc9c;border: none;outline: none;"),t.title="调整列";var n=document.createElement("span");n.style.display="none",n.appendChild(e),n.appendChild(t);var r=document.createElement("button");return r.style.marginLeft="0",r.setAttribute("class","art-buttonTool-hover"),r.innerHTML='<svg class="icon" style="width: 18px; height: 18px;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1283"><path d="M64.021106 512c0-17.672498 14.07353-31.998785 31.887244-31.998785h832.182277c17.6111 0 31.887244 14.202467 31.887244 31.998785 0 17.672498-14.07353 31.998785-31.887244 31.998785H95.909373c-17.6111 0-31.888268-14.20349-31.888267-31.998785zM959.977871 352.007099c0 17.672498-14.326287 31.998785-31.998785 31.998785s-31.998785-14.326287-31.998785-31.998785V160.016437c0-17.672498-14.326287-31.998785-31.998784-31.998785H160.016437c-17.672498 0-31.998785 14.326287-31.998785 31.998785v191.990662c0 17.672498-14.326287 31.998785-31.998785 31.998785s-31.998785-14.326287-31.998785-31.998785V160.016437c0-53.016471 42.97886-95.995331 95.995332-95.995331H863.981517c53.016471 0 95.995331 42.97886 95.995331 95.995331v191.990662z m0 319.984779v191.990662c0 53.016471-42.97886 95.995331-95.995331 95.995331H160.016437c-53.016471 0-95.995331-42.97886-95.995331-95.995331V671.991878c0-17.672498 14.326287-31.998785 31.998785-31.998785s31.998785 14.326287 31.998784 31.998785v191.990662c0 17.672498 14.326287 31.998785 31.998785 31.998785h703.966103c17.672498 0 31.998785-14.326287 31.998785-31.998785V671.991878c0-17.672498 14.326287-31.998785 31.998785-31.998785s31.996738 14.32731 31.996738 31.998785z" p-id="1284"></path></svg>',r.title="调整大小",r.onclick=this.sizeBoxAdjust,r.appendChild(n),r},e.prototype.createMoreButton=function(){var e=document.createElement("button");return e.setAttribute("style","float: right;"),e.setAttribute("class","art-buttonTool-hover"),e.innerHTML='<svg class="icon" style="width: 18px;height: 18px;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1135"><path d="M417.696 224c0-52.928 43.072-96 96-96s96 43.072 96 96-43.072 96-96 96S417.696 276.928 417.696 224zM417.696 512c0-52.928 43.072-96 96-96s96 43.072 96 96-43.072 96-96 96S417.696 564.928 417.696 512zM417.696 800c0-52.928 43.072-96 96-96s96 43.072 96 96-43.072 96-96 96S417.696 852.928 417.696 800z" p-id="1136"></path></svg>',e.title="更多",e.onclick=this.openMore,e},e.prototype.createDelButton=function(){var e=document.createElement("button");return e.setAttribute("style","float: right;"),e.setAttribute("class","art-buttonTool-hover"),e.innerHTML='<svg class="icon" style="width: 18px; height: 18px;color: red;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="689"><path d="M800.162002 316.659033c1.850138-17.575284 17.596773-30.322609 35.172058-28.473495 17.575284 1.850138 30.322609 17.596773 28.473494 35.172058l-57.966202 550.673811c-5.143137 48.856731-46.341445 85.946464-95.467306 85.946464H313.625954c-49.126884 0-90.325192-37.089733-95.468329-85.946464L160.192446 323.358619c-1.850138-17.575284 10.898211-33.32192 28.472471-35.172057 17.575284-1.850138 33.32192 10.898211 35.172058 28.473494l57.965179 550.672788c1.714038 16.285918 15.446807 28.64848 31.822776 28.648481h396.74707c16.375969 0 30.108738-12.363585 31.822776-28.648481l57.967226-550.673811z m-192.176904 99.345636c17.672498 0 31.998785 14.326287 31.998785 31.998785v223.989447c0 17.672498-14.326287 31.998785-31.998785 31.998785s-31.998785-14.326287-31.998785-31.998785V448.00243c0-17.671475 14.326287-31.997762 31.998785-31.997761z m-191.990662 0c17.672498 0 31.998785 14.326287 31.998785 31.998785v223.989447c0 17.672498-14.326287 31.998785-31.998785 31.998785s-31.998785-14.326287-31.998785-31.998785V448.00243c0-17.671475 14.326287-31.997762 31.998785-31.997761z m-31.998785-223.989447h255.987209v-47.998178c0-8.836249-7.163143-15.999392-15.999393-15.999392H399.995043c-8.836249 0-15.999392 7.163143-15.999392 15.999392v47.998178z m-63.996546 0V128.018675c0-35.344996 28.652574-63.996546 63.997569-63.996546h255.987209c35.343973 0 63.996546 28.652574 63.996546 63.996546v63.996547h223.99968c17.672498 0 31.998785 14.326287 31.998785 31.998785s-14.326287 31.998785-31.998785 31.998784H96.019891c-17.672498 0-31.998785-14.326287-31.998785-31.998784s14.326287-31.998785 31.998785-31.998785h223.979214z" p-id="690"></path></svg>',e.title="删除表格",e.onclick=this.delTable,e},e.prototype.openMore=function(e){e.stopPropagation();var t=e.clientY-40-e.offsetY,n=e.clientX+90-e.offsetX,r=e.target.parentNode.parentNode.nextSibling,i=new CustomEvent("art-event",{detail:{type:"MoreTableTool.open",xy:[n,t],table:r},bubbles:!0,cancelable:!1});return e.target.dispatchEvent(i),!1},e.prototype.align=function(e){return function(t){var n=g.sel,r=n.anchorNode,i=n.focusNode;if(r&&i){for(var o=r;"TR"!=o.parentNode.nodeName&&o.parentNode!=document.body;)o=o.parentNode;if("TR"==o.parentNode.nodeName){var s=-1;for(s=o.parentNode.childNodes.length-1;s>=0&&o.parentNode.childNodes[s]!=o;s--);if(-1!=s)for(var a=o.parentNode.parentNode.parentNode,l=0;l<a.rows.length;l++)a.rows[l].cells[s].style.textAlign=e}}}},e.getTableSize=function(e){return e?[e.rows.length,e.rows.item(0).cells.length]:[0,0]},e.setTableSize=function(t,n,r){if(!(r[0]<=2||r[1]<=1)){var i,o=n.dom.childNodes[1],s=e.getTableSize(o);if(r[0]!=s[0])if(r[0]<s[0])for(var a=s[0]-1;a>r[0]-1;a--)t.remove(n.lastChild.lastChild);else for(a=r[0]-s[0];a>0;a--){for(var l=new _("tr"),d=0;d<s[1];d++){var c=new _("td");l.appendChild(c)}t.appendChild(n.lastChild,l)}if(r[1]!=s[1])if(r[1]<s[1])for(a=s[1]-1;a>r[1]-1;a--)for(t.remove(n.firstChild.firstChild.lastChild),i=n.lastChild.firstChild;i;)t.remove(i.lastChild),i=i.next;else for(a=r[1]-s[1];a>0;a--)for(t.appendChild(n.firstChild.firstChild,new _("th")),i=n.lastChild.firstChild;i;)t.appendChild(i,new _("td")),i=i.next;t.update()}},e.prototype.sizeBoxAdjust=function(t){var n=t.target.parentNode.parentNode;if(n.nextSibling&&"TABLE"==n.nextSibling.nodeName){var r=t.target.nextSibling;if("none"==r.style.display){r.style.display="";var i=e.getTableSize(n.nextSibling);r.childNodes[0].value=i[0].toString(),r.childNodes[1].value=i[1].toString()}else{var o=new CustomEvent("art-event",{detail:{type:"TableTool-adjustTable",table:n.parentElement,size:[parseInt(r.childNodes[0].value),parseInt(r.childNodes[1].value)]},bubbles:!0,cancelable:!1});t.target.dispatchEvent(o),r.style.display="none"}}},e.prototype.delTable=function(e){var t=new CustomEvent("art-event",{detail:{type:"TableTool-deleteTable"},bubbles:!0,cancelable:!1});e.target.dispatchEvent(t)},e}();function k(e){var t="";if("#text"===e.nodeName)return e.nodeValue;if("BR"===e.nodeName)return"<br\\>";if("INPUT"==e.nodeName&&e instanceof HTMLInputElement&&"checkbox"===e.type)return e.checked?"[x] ":"[ ] ";if("LI"===e.nodeName){for(var n="",r=!0,i=e.parentElement;i;){if("OL"===i.nodeName)n+="   ";else if("UL"===i.nodeName)n+="  ";else if("item"!==i.nodeName)break;i=i.parentElement}if("OL"===(i=e.parentElement).nodeName){for(var o=0;o<i.childNodes.length;o++)if(i.childNodes[o]===e){t+=o+1+". ";break}}else t+="* ";for(o=0;o<e.childNodes.length;o++)switch(e.childNodes[o].nodeName){case"UL":case"OL":case"BLOCKQUOTE":case"P":var s=(l=k(e.childNodes[o])).substring(0,l.length-1).split("\n");console.log(s,l);for(var a=0;a<s.length;a++)s[a]&&(r?(t+=s[a]+"\n",r=!1):t+=n+s[a]+"\n");break;default:t+=k(e.childNodes[o])}return t}if("BLOCKQUOTE"===e.nodeName){for(o=0;o<e.childNodes.length;o++)switch(e.childNodes[o].nodeName){case"UL":case"OL":case"BLOCKQUOTE":case"P":var l;(s=(l=k(e.childNodes[o])).substring(0,l.length-1).split("\n")).forEach((function(e){return t+="> "+e+"\n"}));break;default:t+="> "+k(e.childNodes[o])}return t}t+=function(e){var t;switch(e.nodeName){case"H1":case"H2":case"H3":case"H4":case"H5":case"H6":return"#".repeat(parseInt(e.nodeName.charAt(1)))+" ";case"A":if(e.childNodes.length)return"[";break;case"EM":return"*";case"STRONG":return"**";case"DEL":return"~~";case"PRE":var n,r=e.firstChild,i="";if("CODE"===(null==r?void 0:r.nodeName))null===(t=r.getAttribute("class"))||void 0===t||t.split(/\s/).forEach((function(e){(n=e.match(/^lang-(.*?)$/))&&(i+=n[1]+" ")}));return"```"+i+"\n"}return""}(e);for(o=0;o<e.childNodes.length;o++)t+=k(e.childNodes[o]);return"PRE"===e.nodeName&&t&&"\n"!==t[t.length-1]&&(t+="\n"),t+=function(e){switch(e.nodeName){case"UL":case"OL":case"BLOCKQUOTE":case"P":case"H1":case"H2":case"H3":case"H4":case"H5":case"H6":return"\n\n";case"A":if(e.childNodes.length)return"]("+e.href+")";break;case"EM":return"*";case"STRONG":return"**";case"DEL":return"~~";case"PRE":return"```\n\n"}return""}(e)}var N,A=function(){function e(e){this.isComposition=!1,this.DOMEvents=[],this.customizeEvents=[],this.artRender=e}return e.prototype.attachAllEvent=function(){this.artRender.dom.onmousedown=function(e){},this.artRender.dom.setAttribute("contenteditable","true");var e,t=this.artRender;b(this),(e=this).addCustomizeEvent("TableTool-deleteTable",(function(){for(var t=e.artRender.doc.firstChild,n=e.artRender.cursor.pos.rowAnchorOffset;-1!=--n;)t=t.next;t.next&&g.setCursor(t.next.dom,0),e.artRender.operation.remove(t),e.artRender.operation.update()})),e.addCustomizeEvent("TableTool-adjustTable",(function(t){for(var n=e.artRender.doc.firstChild;n&&n.dom!==t.table;)n=n.next;console.log(n),w.setTableSize(e.artRender.operation,n,t.size)})),this.addCustomizeEvent("MoreTableTool.open",(function(e){return t.tableMoreTool.open(t,e),!1})),this.addCustomizeEvent("DOM.click",(function(){t.artText.get("$eventCenter").emit("floatAuxiliaryTool.close"),t.tableMoreTool.close()})),this.addCustomizeEvent("DOM.mousewheel",(function(){t.artText.get("$eventCenter").emit("floatAuxiliaryTool.close"),t.tableMoreTool.close()})),this.addDOMEvent("keydown",this.keydown),this.addDOMEvent("keyup",this.keyup),this.addDOMEvent("compositionstart",(function(e,t){t.isComposition=!0})),this.addDOMEvent("compositionend",(function(e,t){t.isComposition=!1})),this.addDOMEvent("click",this.click),this.addDOMEvent("contextmenu",this.contextmenu);var n=this.artRender.artText.get("$eventCenter");this.artRender.artText.get("$eventCenter").attachDOMEvent(document.body,"mousewheel",(function(e){return n.emit("DOM."+e.type)})),this.addDOMEvent("paste",this.paste),this.addDOMEvent("copy",this.copy),this.addDOMEvent("drop",this.drop)},e.prototype.detachAllEvent=function(){for(var e,t=0,n=this.customizeEvents;t<n.length;t++){var r=n[t];(e=this.artRender.artText.get("$eventCenter")).off.apply(e,r)}for(var i=0,o=this.DOMEvents;i<o.length;i++){var s=o[i];this.artRender.artText.get("$eventCenter").detachDOMEvent(s)}this.customizeEvents=[],this.DOMEvents=[],this.artRender.dom.setAttribute("contenteditable","false")},e.prototype.addDOMEvent=function(e,t){var n=this;var r=this.artRender.artText.get("$eventCenter").attachDOMEvent(this.artRender.dom,e,(function(e){return n.artRender.artText.get("$eventCenter").emit("DOM."+e.type),t(e,n)}));this.DOMEvents.push(r)},e.prototype.addCustomizeEvent=function(e,t){this.artRender.artText.get("$eventCenter").on(e,t),this.customizeEvents.push([e,t])},e.prototype.keydown=function(e,t){var n=e.key;return t.shortcutKey(e,t.artRender.artText)||/^Arrow(Right|Left|Up|Down)$/.test(n)&&t.artRender.cursor.moveCursor(n)?(e.preventDefault(),!1):!(!t.isComposition&&!t.artRender.interaction.render(n,"keydown"))||(e.preventDefault(),!1)},e.prototype.shortcutKey=function(e,t){return!!e.ctrlKey&&t.get("$eventCenter").emit("art-ShortcutKey-Control+"+e.key)},e.prototype.keyup=function(e,t){var n=e.key;return"Backspace"==n&&""==t.artRender.dom.innerHTML&&(t.artRender.dom.innerHTML="<p><br/></p>"),!!t.isComposition||t.artRender.interaction.render(n,"keyup",e)},e.prototype.click=function(e,t){var n=e.target;if(e.altKey&&"A"==n.nodeName){var r=void 0;if("#"===n.getAttribute("href")){var i=n.getAttribute("art-data-ref");if(!t.artRender.refmap.has(i))return;r=t.artRender.refmap.get(i).destination}else r=n.href;window.open(r)}else{var o=t.artRender.cursor;o.getSelection(),o.setSelection()}},e.prototype.contextmenu=function(e,t){e.preventDefault(),t.artRender.artText.get("$eventCenter").emit("floatAuxiliaryTool.open",e.clientX,e.clientY)},e.prototype.copy=function(e,t){var n=t.artRender.getSelectNodeMd();e.clipboardData.setData("text/markdown",n)},e.prototype.paste=function(e,t){if(e.clipboardData&&e.clipboardData.items){t.artRender.cursor.getSelection();for(var n,r=t.artRender.cursor.pos,i=t.artRender.doc.firstChild,o=r.rowAnchorOffset;--o>-1;)i=i.next;if(console.log(e.clipboardData),n=e.clipboardData.getData("text/markdown2")){console.log(n,i);var s=t.artRender.cursor.pos;if(s.selection.isCollapsed){if("PRE"===s.rowNode.nodeName)return!0;console.log(n);var a=t.artRender.interaction.parser.parse(n);t.artRender.interaction.parser.parser.refmap.forEach((function(e,n){t.artRender.refmap.set(n,e)}));for(var l=a.lastChild,d=void 0;l;)d=l.prev,t.artRender.operation.insertAfter(l,i),l=d;return t.artRender.operation.update(),!1}return!1}if(n=e.clipboardData.getData("text/html")){var c=document.createElement("html");c.innerHTML=n;var h=c.childNodes[1],p=k(h);console.log(n,h,p);a=t.artRender.interaction.parser.parse(p);t.artRender.interaction.parser.parser.refmap.forEach((function(e,n){t.artRender.refmap.set(n,e)}));for(l=a.lastChild,d=void 0;l;)d=l.prev,t.artRender.operation.insertAfter(l,i),l=d;return t.artRender.operation.update(),e.preventDefault(),!1}return(n=e.clipboardData.getData("text/plain"))?(console.log(n),!1):void 0}},e.prototype.cut=function(e,t){return t.copy(e,t),t.artRender.deleteSelectNode(),e.preventDefault(),!1},e.prototype.drop=function(e,t){e.preventDefault();for(var n=function(n,r){var i=e.dataTransfer.files[n],o=new FileReader;if(/.*\.md$/.test(i.name)||"text/plain"==i.type)o.onload=function(){o.result&&t.artRender.artText.get("$editor").openFile({defaultMd:o.result.toString(),name:i.name})},o.readAsText(i);else if(/^image\/(png|jpe?g)$/.test(i.type)){console.log(i,o);t.artRender.artText.get("$eventCenter").emit("art-uploadImage",[i,function(n,r){(new Image).src=n;var i=document.createElement("span");i.setAttribute("class","art-hide");var o=new Text("!["+r+"]("+n+")");i.appendChild(o),e.target.appendChild(o),t.artRender.interaction.render(null,"keyup")}])}else t.artRender.artText.get("message").create("不支持该文件类型","error")},r=0,i=e.dataTransfer.files.length;r<i;r++)n(r)},e}(),D=function(){function e(){this.moreDom=null}return e.prototype.createLi=function(e,t){var n=document.createElement("li");n.className="art-floatTool-li",n.innerHTML=e;var r=this;n.onclick=function(){t(r),r.close()},this.moreDom.appendChild(n)},e.prototype.createDom=function(){this.moreDom=document.createElement("ul"),this.moreDom.style.display="none",this.moreDom.setAttribute("class","art-floatTool"),this.createLi("上方插入一行",this.insertUpLine),this.createLi("下方插入一行",this.insertDownLine);var e=document.createElement("li");return e.className="art-divider",this.moreDom.appendChild(e),this.createLi("左边插入一列",this.insertLeftColumn),this.createLi("右边插入一列",this.insertRightColumn),(e=document.createElement("li")).className="art-divider",this.moreDom.appendChild(e),this.createLi("删除行",this.deleteLine),this.createLi("删除列",this.deleteColumn),this.moreDom},e.prototype.insertUpLine=function(e){var t,n=e.thtdDom.parentNode,r=new _("tr");if(e.tableDom.rows[0]==n){for(var i=new _("tr"),o=e.thtdNode.parent.firstChild,s=0;s<n.childNodes.length&&o;s++,o=o.next){var a=new _("th");s==e.pos.column&&(t=a),r.appendChild(a);var l=new _("td"),d=o.getMd();d.length&&10===d.charCodeAt(d.length-1)&&(d=d.substring(0,d.length-1)),l._string_content=d,e.artRender.interaction.parser.inlineParse(l),i.appendChild(l),(c=n.childNodes[s].getAttribute("style"))&&(a._info.style=c,l._info.style=c)}e.artRender.operation.replace(r,e.tableNode.firstChild.firstChild),e.artRender.operation.insertBefore(i,e.tableNode.lastChild.firstChild)}else{for(s=0;s<n.childNodes.length;s++){var c;l=new _("td");s==e.pos.column&&(t=l),(c=n.childNodes[s].getAttribute("style"))&&(l._info.style=c),r.appendChild(l)}e.artRender.operation.insertBefore(r,e.thtdNode.parent)}e.artRender.operation.update(),g.setCursor(t.dom,0)},e.prototype.insertDownLine=function(e){for(var t,n=e.thtdDom.parentNode,r=new _("tr"),i=0;i<n.childNodes.length;i++){var o=new _("td");i==e.pos.column&&(t=o),r.appendChild(o);var s=n.childNodes[i].getAttribute("style");s&&(o._info.style=s)}e.tableDom.rows[e.tableDom.rows.length-1]==n?e.artRender.operation.appendChild(r,e.thtdNode.parent):e.tableDom.rows[0]==n?e.artRender.operation.insertBefore(r,e.tableNode.lastChild.firstChild):e.artRender.operation.insertAfter(r,e.thtdNode.parent),e.artRender.operation.update(),g.setCursor(t.dom,0)},e.prototype.insertLeftColumn=function(e){for(var t,n,r=e.tableNode.firstChild.firstChild.firstChild,i=0;i<e.pos.column;i++)r=r.next;n=new _("th"),0===e.pos.row&&(t=n),e.artRender.operation.insertBefore(n,r);for(var o,s=e.tableNode.lastChild.firstChild,a=1;a<e.tableDom.rows.length;a++,s=s.next){o=s.firstChild;for(i=0;i<e.pos.column;i++)o=o.next;n=new _("td"),e.pos.row===a&&(t=n),e.artRender.operation.insertBefore(n,o)}e.artRender.operation.update(),g.setCursor(t.dom,0)},e.prototype.insertRightColumn=function(e){for(var t,n,r=e.tableNode.firstChild.firstChild.firstChild,i=0;i<e.pos.column;i++)r=r.next;n=new _("th"),0===e.pos.row&&(t=n),e.artRender.operation.insertAfter(n,r);for(var o,s=e.tableNode.lastChild.firstChild,a=1;a<e.tableDom.rows.length;a++,s=s.next){o=s.firstChild;for(i=0;i<e.pos.column;i++)o=o.next;n=new _("td"),e.pos.row===a&&(t=n),e.artRender.operation.insertAfter(n,o)}e.artRender.operation.update(),g.setCursor(t.dom,0)},e.prototype.deleteLine=function(e){var t,n;if(e.pos.row){for(var r=e.tableNode.lastChild.firstChild,i=1;i<e.pos.row;i++)r=r.next;n=r.next;for(i=0;i<e.pos.column;i++)n=n.next;t=n,e.artRender.operation.remove(r)}else{r=new _("tr");for(var o=e.tableNode.lastChild.firstChild.firstChild;o;){var s=new _("th"),a=o.dom.getAttribute("style");a&&(s._info.style=a);var l=o.getMd();l.length&&10===l.charCodeAt(l.length-1)&&(l=l.substring(0,l.length-1)),s._string_content=l,e.artRender.interaction.parser.inlineParse(s),r.appendChild(s),o=o.next}e.artRender.operation.replace(r,e.tableNode.firstChild.firstChild),e.artRender.operation.remove(e.tableNode.lastChild.firstChild),n=r.firstChild;for(i=0;i<e.pos.column;i++)n=n.next;t=n}e.artRender.operation.update(),g.setCursor(t.dom,0)},e.prototype.deleteColumn=function(e){for(var t,n=e.tableNode.firstChild.firstChild.firstChild,r=0;r<e.pos.column;r++)n=n.next;0===e.pos.row&&(t=n.next?n.next:n.prev),e.artRender.operation.remove(n);for(var i,o=e.tableNode.lastChild.firstChild,s=1;s<e.tableDom.rows.length;s++,o=o.next){i=o.firstChild;for(r=0;r<e.pos.column;r++)i=i.next;e.pos.row===s&&(t=i.next?i.next:i.prev),e.artRender.operation.remove(i)}e.artRender.operation.update(),g.setCursor(t.dom,0)},e.prototype.open=function(e,t){this.artRender=e;var n=g.sel,r=n.anchorNode,i=n.anchorOffset;g.setCursor(r,i);for(var o=r;"TR"!=o.parentNode.nodeName&&o.parentNode!=document.body;)o=o.parentNode;if("TR"==o.parentNode.nodeName){this.thtdDom=o,this.moreDom.style.display="inherit",this.moreDom.style.top=t.xy[1].toString()+"px",this.moreDom.style.left=t.xy[0].toString()+"px";for(var s=e.doc.firstChild,a=e.cursor.pos.rowAnchorOffset;-1!=--a;)s=s.next;this.tableNode=s,this.tableDom=this.tableNode.dom.childNodes[1],this.pos={column:0,row:0};for(var l=this.tableNode.firstChild.firstChild.firstChild;l;){if(l.dom===e.cursor.pos.rowNode){this.thtdNode=l;break}this.pos.column++,l=l.next}if(!l)for(var d=this.tableNode.lastChild.firstChild,c=void 0;d;){for(c=d.firstChild,this.pos.row++,this.pos.column=0;c;){if(c.dom===e.cursor.pos.rowNode){this.thtdNode=c;break}this.pos.column++,c=c.next}if(c)break;d=d.next}}},e.prototype.close=function(){this.moreDom.style.display="none"},e}(),E=n(8),T={insert:"head",singleton:!1},L=(a()(E.a,T),E.a.locals,"&(?:#x[a-f0-9]{1,6}|#[0-9]{1,7}|[a-z][a-z0-9]{1,31});"),O="[A-Za-z][A-Za-z0-9-]*",S="(?:\\s+[a-zA-Z_:][a-zA-Z0-9:._-]*(?:\\s*=\\s*(?:[^\"'=<>`\\x00-\\x20]+|'[^']*'|\"[^\"]*\"))?)",R="<"+O+S+"*\\s*/?>",F="</"+O+"\\s*[>]",M=new RegExp("^(?:<[A-Za-z][A-Za-z0-9-]*(?:\\s+[a-zA-Z_:][a-zA-Z0-9:._-]*(?:\\s*=\\s*(?:[^\"'=<>`\\x00-\\x20]+|'[^']*'|\"[^\"]*\"))?)*\\s*/?>|</[A-Za-z][A-Za-z0-9-]*\\s*[>]|\x3c!----\x3e|\x3c!--(?:-?[^>-])(?:-?[^-])*--\x3e|[<][?][\\s\\S]*?[?][>]|<![A-Z]+\\s+[^>]*>|<!\\[CDATA\\[[\\s\\S]*?\\]\\]>)"),B=/[\\&]/,H="[!\"#$%&'()*+,./:;<=>?@[\\\\\\]^_`{|}~-]",z=new RegExp("\\\\"+H+"|"+L,"gi"),$=(new RegExp('[&<>"]',"g"),function(e){return 92===e.charCodeAt(0)?e.charAt(1):e}),P=function(e){return B.test(e)?e.replace(z,$):e};function j(e){return N(e)}if(String.fromCodePoint)N=function(e){try{return String.fromCodePoint(e)}catch(e){if(e instanceof RangeError)return String.fromCharCode(65533);throw e}};else{var I=String.fromCharCode,q=Math.floor;N=function(){var e,t,n=16384,r=[],i=-1,o=arguments.length;if(!o)return"";for(var s="";++i<o;){var a=Number(arguments[i]);if(!isFinite(a)||a<0||a>1114111||q(a)!==a)return String.fromCharCode(65533);a<=65535?r.push(a):(e=55296+((a-=65536)>>10),t=a%1024+56320,r.push(e,t)),(i+1===o||r.length>n)&&(s+=I.apply(null,r),r.length=0)}return s}}var U=function(e){try{return e}catch(t){return e}},V=P,Z=/^\[(\s|x|X)\]/,K="\\\\[!\"#$%&'()*+,./:;<=>?@[\\\\\\]^_`{|}~-]",J=M,G=new RegExp(/[!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u0AF0\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166D\u166E\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2010-\u2027\u2030-\u2043\u2045-\u2051\u2053-\u205E\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E42\u3001-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]|\uD800[\uDD00-\uDD02\uDF9F\uDFD0]|\uD801\uDD6F|\uD802[\uDC57\uDD1F\uDD3F\uDE50-\uDE58\uDE7F\uDEF0-\uDEF6\uDF39-\uDF3F\uDF99-\uDF9C]|\uD804[\uDC47-\uDC4D\uDCBB\uDCBC\uDCBE-\uDCC1\uDD40-\uDD43\uDD74\uDD75\uDDC5-\uDDC9\uDDCD\uDDDB\uDDDD-\uDDDF\uDE38-\uDE3D\uDEA9]|\uD805[\uDCC6\uDDC1-\uDDD7\uDE41-\uDE43\uDF3C-\uDF3E]|\uD809[\uDC70-\uDC74]|\uD81A[\uDE6E\uDE6F\uDEF5\uDF37-\uDF3B\uDF44]|\uD82F\uDC9F|\uD836[\uDE87-\uDE8B]/),Q=new RegExp('^(?:"('+K+'|[^"\\x00])*"|\'('+K+"|[^'\\x00])*'|\\(("+K+"|[^()\\x00])*\\))"),X=/^(?:<(?:[^<>\n\\\x00]|\\.)*>)/,Y=new RegExp("^[!\"#$%&'()*+,./:;<=>?@[\\\\\\]^_`{|}~-]"),W=new RegExp("^&(?:#x[a-f0-9]{1,6}|#[0-9]{1,7}|[a-z][a-z0-9]{1,31});","i"),ee=/`+/,te=/^`+/,ne=/\.\.\./g,re=/--+/g,ie=/^<([a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*)>/,oe=/^<[A-Za-z][A-Za-z0-9.+-]{1,31}:[^<>\x00-\x20]*>/i,se=/^ *(?:\n *)?/,ae=/^[ \t\n\x0b\x0c\x0d]/,le=/^\s/,de=/ *$/,ce=/^ */,he=/^ *(?:\n|$)/,pe=/^\[(?:[^\\\[\]]|\\.){0,1000}\]/,ue=/^[^\n`\[\]\\!<&*_'"~$]+/m;function fe(e){var t=new _("text");return t._literal=e,t}function me(e){return e.slice(1,e.length-1).trim().replace(/[ \t\r\n]+/," ")}function ge(e,t){e.next!==t&&(e.next=t,t.previous=e)}var be=function(){function e(e){void 0===e&&(e={smart:""}),this.subject="",this.delimiters=null,this.brackets=null,this.pos=0,this.refmap=new Map,this.options=e}return e.prototype.match=function(e){var t=e.exec(this.subject.slice(this.pos));return null===t?null:(this.pos+=t.index+t[0].length,t[0])},e.prototype.peek=function(){return this.pos<this.subject.length?this.subject.charCodeAt(this.pos):-1},e.prototype.spnl=function(){return this.match(se),!0},e.prototype.parseBackticks=function(e){var t=this.match(te);if(null===t)return!1;for(var n,r,i,o=this.pos;null!==(n=this.match(ee));)if(n===t)return r=new _("code"),(i=this.subject.slice(o,this.pos-t.length).replace(/\n/gm," ")).length>0&&null!==i.match(/[^ ]/)&&" "==i[0]&&" "==i[i.length-1]?r._literal=i.slice(1,i.length-1):r._literal=i,e.appendChild(r),!0;return this.pos=o,e.appendChild(fe(t)),!0},e.prototype.parseBackslash=function(e){var t,n=this.subject;return this.pos+=1,10===this.peek()?(this.pos+=1,t=new _("linebreak"),e.appendChild(t)):Y.test(n.charAt(this.pos))?(e.appendChild(fe(n.charAt(this.pos))),this.pos+=1):e.appendChild(fe("\\")),!0},e.prototype.parseAutolink=function(e){var t,n,r;return(t=this.match(ie))?(n=t.slice(1,t.length-1),(r=new _("link"))._info={type:"autolink"},r._destination=U("mailto:"+n),r._title="",r.appendChild(fe(n)),e.appendChild(r),!0):!!(t=this.match(oe))&&(n=t.slice(1,t.length-1),(r=new _("link"))._info={type:"autolink"},r._destination=U(n),r._title="",r.appendChild(fe(n)),e.appendChild(r),!0)},e.prototype.parseHtmlTag=function(e){var t=this.match(J);if(null===t)return!1;var n=new _("html_inline");return n._literal=t,e.appendChild(n),!0},e.prototype.scanDelims=function(e){var t,n,r,i,o,s,a,l,d,c,h,p=0,u=this.pos;if(39===e||34===e)p++,this.pos++;else for(;this.peek()===e;)p++,this.pos++;return 0===p?null:(t=0===u?"\n":this.subject.charAt(u-1),n=-1===(r=this.peek())?"\n":j(r),l=le.test(n),d=G.test(n),c=le.test(t),h=G.test(t),i=!l&&(!d||c||h),o=!c&&(!h||l||d),95===e?(s=i&&(!o||h),a=o&&(!i||d)):39===e||34===e?(s=i&&!o,a=o):(s=i,a=o),this.pos=u,{numdelims:p,can_open:s,can_close:a})},e.prototype.handleDelim=function(e,t){var n=this.scanDelims(e);if(!n)return!1;var r,i=n.numdelims,o=this.pos;if(this.pos+=i,(r=39===e?"’":34===e?"“":this.subject.slice(o,this.pos))==String.fromCharCode(126))return this.pos-=i,!1;var s=fe(r);return t.appendChild(s),(n.can_open||n.can_close)&&(this.options.smart||39!==e&&34!==e)&&(this.delimiters={cc:e,numdelims:i,origdelims:i,node:s,previous:this.delimiters,next:null,can_open:n.can_open,can_close:n.can_close},null!==this.delimiters.previous&&(this.delimiters.previous.next=this.delimiters)),!0},e.prototype.parseLinkTitle=function(){var e=this.match(Q);return null===e?null:V(e.substr(1,e.length-2))},e.prototype.parseLinkDestination=function(){var e=this.match(X);if(null===e){if(60===this.peek())return null;for(var t,n=this.pos,r=0;-1!==(t=this.peek());)if(92===t&&Y.test(this.subject.charAt(this.pos+1)))this.pos+=1,-1!==this.peek()&&(this.pos+=1);else if(40===t)this.pos+=1,r+=1;else if(41===t){if(r<1)break;this.pos+=1,r-=1}else{if(null!==ae.exec(j(t)))break;this.pos+=1}return this.pos===n&&41!==t||0!==r?null:(e=this.subject.substr(n,this.pos-n),U(V(e)))}return U(V(e.substr(1,e.length-2)))},e.prototype.parseLinkLabel=function(){var e=this.match(pe);return null===e||e.length>1001?0:e.length},e.prototype.parseOpenBracket=function(e){var t=this.pos;this.pos+=1;var n=fe("[");return e.appendChild(n),this.addBracket(n,t,!1),!0},e.prototype.parseBang=function(e){var t=this.pos;if(this.pos+=1,91===this.peek()){this.pos+=1;var n=fe("![");e.appendChild(n),this.addBracket(n,t+1,!0)}else e.appendChild(fe("!"));return!0},e.prototype.parseCloseBracket=function(e){var t,n,r,i,o,s,a="link",l=!1;if(this.pos+=1,t=this.pos,null===(s=this.brackets))return e.appendChild(fe("]")),!0;if(!s.active)return e.appendChild(fe("]")),this.removeBracket(),!0;n=s.image;var d=this.pos;if(40===this.peek()&&(this.pos++,this.spnl()&&null!==(r=this.parseLinkDestination())&&this.spnl()&&(ae.test(this.subject.charAt(this.pos-1))&&(i=this.parseLinkTitle()),1)&&this.spnl()&&41===this.peek()?(this.pos+=1,l=!0):this.pos=d),!l){var c=this.pos,h=this.parseLinkLabel(),p=!1;if(h>2?(o=this.subject.slice(c,c+h),c>0&&this.subject.substring(0,c).match(/\[(?:[^\\\[\]]|\\.){0,1000}\]$/)&&(p=!0)):s.bracketAfter||(o=this.subject.slice(s.index,t),this.pos!==c&&s.index>0&&this.subject.substring(0,s.index).match(/\[(?:[^\\\[\]]|\\.){0,1000}\]$/)&&(p=!0)),0===h&&(this.pos=d),o&&p){if(this.refmap.has(me(o))){var u=this.refmap.get(me(o));r=u.destination,i=u.title}a="deflink",l=!0}}if(l){var f,m,g=new _(n?"image":"link");for(g._info={type:a,destination:""},o&&(g._info.destination=me(o)),g._destination=r,g._title=i||"",f=s.node._next;f;)m=f._next,f.unlink(),g.appendChild(f),f=m;if(e.appendChild(g),this.processEmphasis(s.previousDelimiter),this.removeBracket(),s.node.unlink(),!n)for(s=this.brackets;null!==s;)s.image||(s.active=!1),s=s.previous;return!0}return this.removeBracket(),this.pos=t,e.appendChild(fe("]")),!0},e.prototype.addBracket=function(e,t,n){null!==this.brackets&&(this.brackets.bracketAfter=!0),this.brackets={node:e,previous:this.brackets,previousDelimiter:this.delimiters,index:t,image:n,active:!0}},e.prototype.removeBracket=function(){this.brackets=this.brackets.previous},e.prototype.parseEntity=function(e){var t;return!!(t=this.match(W))&&(e.appendChild(fe(t)),!0)},e.prototype.parseString=function(e){var t;return!!(t=this.match(ue))&&(this.options.smart?e.appendChild(fe(t.replace(ne,"…").replace(re,(function(e){var t=0,n=0;return e.length%3==0?n=e.length/3:e.length%2==0?t=e.length/2:e.length%3==2?(t=1,n=(e.length-2)/3):(t=2,n=(e.length-4)/3),"—".repeat(n)+"–".repeat(t)})))):e.appendChild(fe(t)),!0)},e.prototype.parseNewline=function(e){this.pos+=1;var t=e.lastChild;if(t&&"text"===t.type&&" "===t._literal[t._literal.length-1]){var n=" "===t._literal[t._literal.length-2];t._literal=t._literal.replace(de,""),e.appendChild(new _(n?"linebreak":"softbreak"))}else e.appendChild(new _("softbreak"));return this.match(ce),!0},e.prototype.parseReference=function(e,t){var n,r,i,o;this.subject=e,this.pos=0;var s=this.pos;if(0===(o=this.parseLinkLabel()))return 0;if(n=this.subject.substr(0,o),58!==this.peek())return this.pos=s,0;if(this.pos++,this.spnl(),null===(r=this.parseLinkDestination()))return this.pos=s,0;var a=this.pos;this.spnl(),this.pos!==a&&(i=this.parseLinkTitle()),null===i&&(i="",this.pos=a);var l=!0;if(null===this.match(he)&&(""===i?l=!1:(i="",this.pos=a,l=null!==this.match(he))),!l)return this.pos=s,0;var d=me(n);return""===d?(this.pos=s,0):(t.has(d)||t.set(d,{destination:r,title:i}),this.pos-s)},e.prototype.parseInline=function(e){var t=!1,n=this.peek();if(-1===n)return!1;switch(n){case 10:t=this.parseNewline(e);break;case 92:t=this.parseBackslash(e);break;case 96:t=this.parseBackticks(e);break;case 36:case 126:case 42:case 95:t=this.handleDelim(n,e);break;case 39:case 34:t=this.options.smart&&this.handleDelim(n,e);break;case 91:t=this.parseOpenBracket(e);break;case 33:t=this.parseBang(e);break;case 93:t=this.parseCloseBracket(e);break;case 60:t=this.parseAutolink(e)||this.parseHtmlTag(e);break;case 38:t=this.parseEntity(e);break;default:t=this.parseString(e)}return t||(this.pos+=1,e.appendChild(fe(j(n)))),!0},e.prototype.processEmphasis=function(e){for(var t,n,r,i,o,s,a,l,d,c,h=[[],[],[]],p=!1,u=0;u<3;u++)h[u][95]=e,h[u][42]=e,h[u][39]=e,h[u][34]=e;for(n=this.delimiters;null!==n&&n.previous!==e;)n=n.previous;for(;null!==n;){var f=n.cc;if(n.can_close){for(t=n.previous,c=!1;null!==t&&t!==e&&t!==h[n.origdelims%3][f];){if(p=(n.can_open||t.can_close)&&n.origdelims%3!=0&&(t.origdelims+n.origdelims)%3==0,t.cc===n.cc&&t.can_open&&!p){c=!0;break}t=t.previous}if(r=n,42===f||95===f)if(c){a=n.numdelims>=2&&t.numdelims>=2?2:1,i=t.node,o=n.node;var m=i._literal.length>o._literal.length?o._literal:i._literal;for(t.numdelims-=a,n.numdelims-=a,i._literal=i._literal.slice(0,i._literal.length-a),o._literal=o._literal.slice(0,o._literal.length-a),(b=new _(1===a?"emph":"strong")).attrs.set("art-marker",m),l=i.next;l&&l!==o;)d=l._next,l.unlink(),b.appendChild(l),l=d;i.insertAfter(b),ge(t,n),0===t.numdelims&&(i.unlink(),this.removeDelimiter(t)),0===n.numdelims&&(o.unlink(),s=n.next,this.removeDelimiter(n),n=s)}else n=n.next;else if(36===f)if(c){a=n.numdelims>=2&&t.numdelims>=2?2:1,i=t.node,o=n.node;m=i._literal;if(t.numdelims-=a,n.numdelims-=a,i._literal=i._literal.slice(0,i._literal.length-a),o._literal=o._literal.slice(0,o._literal.length-a),1===a){var g=new _("math");for(l=i.next;l&&l!==o;)d=l._next,l.unlink(),g.appendChild(l),l=d;i.insertAfter(g),ge(t,n),0===t.numdelims&&(i.unlink(),this.removeDelimiter(t)),0===n.numdelims&&(o.unlink(),s=n.next,this.removeDelimiter(n),n=s)}}else n=n.next;else if(126===f)if(c){a=n.numdelims>=2&&t.numdelims>=2?2:1,i=t.node,o=n.node;var b;m=i._literal;for(t.numdelims-=a,n.numdelims-=a,i._literal=i._literal.slice(0,i._literal.length-a),o._literal=o._literal.slice(0,o._literal.length-a),(b=new _(1===a?"sub":"delete")).attrs.set("art-marker",m),l=i.next;l&&l!==o;)d=l._next,l.unlink(),b.appendChild(l),l=d;i.insertAfter(b),ge(t,n),0===t.numdelims&&(i.unlink(),this.removeDelimiter(t)),0===n.numdelims&&(o.unlink(),s=n.next,this.removeDelimiter(n),n=s)}else n=n.next;else 39===f?(n.node._literal="’",c&&(t.node._literal="‘"),n=n.next):34===f&&(n.node._literal="”",c&&(t.node.literal="“"),n=n.next);c||(h[r.origdelims%3][f]=r.previous,r.can_open||this.removeDelimiter(r))}else n=n.next}for(;null!==this.delimiters&&this.delimiters!==e;)this.removeDelimiter(this.delimiters)},e.prototype.removeDelimiter=function(e){null!==e.previous&&(e.previous.next=e.next),null===e.next?this.delimiters=e.previous:e.next.previous=e.previous},e.prototype.parseInlines=function(e){var t;if(e.parent&&"item"===e.parent.type&&(t=e._string_content.match(Z))){var n=new _("item_checkbox");n.attrs.set("type","checkbox"),n.attrs.set("disabled","disabled")," "!==t[1]&&n.attrs.set("checked","checked"),e.insertBefore(n),e._string_content=e._string_content.substring(3)}for(this.subject=e._string_content.trim(),this.pos=0,this.delimiters=null,this.brackets=null;this.parseInline(e););e._string_content=null,this.processEmphasis(null)},e.prototype.parse=function(e){this.parseInlines(e)},e}(),ve=/^\[((?:[^\\\[\]]|\\.){0,1000})\]/,ye=[/./,/^<(?:script|pre|textarea|style)(?:\s|>|$)/i,/^<!--/,/^<[?]/,/^<![A-Z]/,/^<!\[CDATA\[/,/^<[/]?(?:address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[123456]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|nav|noframes|ol|optgroup|option|p|param|section|source|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul)(?:\s|[/]?[>]|$)/i,new RegExp("^(?:"+R+"|"+F+")\\s*$","i")],Ce=[/./,/<\/(?:script|pre|textarea|style)>/i,/-->/,/\?>/,/>/,/\]\]>/],xe=/^(?:(?:\*[ \t]*){3,}|(?:_[ \t]*){3,}|(?:-[ \t]*){3,})[ \t]*$/,_e=/^[#`~*+_=<>0-9-|\$]/,we=/[^ \t\f\v\r\n]/,ke=/^[*+-]/,Ne=/^(\d{1,9})([.)])/,Ae=/^#{1,6}(?:[ \t]+|$)/,De=/^`{3,}(?!.*`)|^~{3,}/,Ee=/^\$\$/,Te=/^(?:`{3,}|~{3,})(?= *$)/,Le=/^\|(\s*:?-{3,}:?\s*\|)+/,Oe=/^\|(.*?\|)+/,Se=/^(?:=+|-+)[ \t]*$/,Re=/\r\n|\n|\r/;function Fe(e){return 32===e||9===e}function Me(e,t){return t<e.length?e.charCodeAt(t):-1}function Be(e){for(;e;){if(e._lastLineBlank)return!0;var t=e.type;if(e._lastLineChecked||"list"!==t&&"item"!==t){e._lastLineChecked=!0;break}e._lastLineChecked=!0,e=e.lastChild}return!1}var He={document:{continue:function(){return 0},finalize:function(){},canContain:function(e){return"item"!==e},acceptsLines:!1},list:{continue:function(){return 0},finalize:function(e,t){for(var n=t.firstChild;n;){if(Be(n)&&n.next){t._listData.tight=!1;break}for(var r=n.firstChild;r;){if(Be(r)&&(n.next||r.next)){t._listData.tight=!1;break}r=r.next}n=n.next}},canContain:function(e){return"item"===e},acceptsLines:!1},block_quote:{continue:function(e){var t=e.currentLine;return e.indented||62!==Me(t,e.nextNonspace)?1:(e.advanceNextNonspace(),e.advanceOffset(1,!1),Fe(Me(t,e.offset))&&e.advanceOffset(1,!0),0)},finalize:function(){},canContain:function(e){return"item"!==e},acceptsLines:!1},item:{continue:function(e,t){if(e.blank){if(null==t.firstChild)return 1;e.advanceNextNonspace()}else{if(!(e.indent>=t._listData.markerOffset+t._listData.padding))return 1;e.advanceOffset(t._listData.markerOffset+t._listData.padding,!0)}return 0},finalize:function(){},canContain:function(e){return"item"!==e},acceptsLines:!1},heading:{continue:function(){return 1},finalize:function(){},canContain:function(){return!1},acceptsLines:!1},thematic_break:{continue:function(){return 1},finalize:function(){},canContain:function(){return!1},acceptsLines:!1},code_block:{continue:function(e,t){var n=e.currentLine,r=e.indent;if(t._isFenced){var i=r<=3&&n.charAt(e.nextNonspace)===t._fenceChar&&n.slice(e.nextNonspace).match(Te);if(i&&i[0].length>=t._fenceLength)return e.lastLineLength=e.offset+r+i[0].length,e.finalize(t,e.lineNumber),2;for(var o=t._fenceOffset;o>0&&Fe(Me(n,e.offset));)e.advanceOffset(1,!0),o--}else if(r>=4)e.advanceOffset(4,!0);else{if(!e.blank)return 1;e.advanceNextNonspace()}return 0},finalize:function(e,t){if(t._isFenced){var n=t._string_content,r=n.indexOf("\n"),i=n.slice(0,r),o=n.slice(r+1);t._info=P(i.trim()),t._literal=o}else t._literal=t._string_content.replace(/(\n *)+$/,"\n");t._string_content=null},canContain:function(){return!1},acceptsLines:!0},math_block:{continue:function(e,t){var n=e.currentLine,r=e.indent;if(t._isFenced){var i=r<=3&&n.charAt(e.nextNonspace)===t._fenceChar&&n.slice(e.nextNonspace).match(Te);if(i&&i[0].length>=t._fenceLength)return e.lastLineLength=e.offset+r+i[0].length,e.finalize(t,e.lineNumber),2;for(var o=t._fenceOffset;o>0&&Fe(Me(n,e.offset));)e.advanceOffset(1,!0),o--}else if(r>=4)e.advanceOffset(4,!0);else{if(!e.blank)return 1;e.advanceNextNonspace()}return 0},finalize:function(e,t){},canContain:function(){return!1},acceptsLines:!0},html_block:{continue:function(e,t){return!e.blank||6!==t._htmlBlockType&&7!==t._htmlBlockType?0:1},finalize:function(e,t){t._literal=t._string_content.replace(/(\n *)+$/,""),t._string_content=null},canContain:function(){return!1},acceptsLines:!0},table:{continue:function(e,t){var n=e.currentLine.slice(e.nextNonspace).match(Oe);if(n){var r=t.lastChild,i=new _("tr",t.sourcepos);r.appendChild(i);for(var o=n.input.split("|"),s=1;s<o.length-1;s++){var a=new _("td",t.sourcepos);a._info={style:r.parent._info.styles[s-1]},a._string_content=o[s],i.appendChild(a)}return 2}return 1},finalize:function(e,t){},canContain:function(){return!1},acceptsLines:!0},def_link:{continue:function(e,t){return 1}},paragraph:{continue:function(e){return e.blank?1:0},finalize:function(e,t){for(var n,r,i,o=!1;91===Me(t._string_content,0)&&(n=e.inlineParser.parseReference(t._string_content,e.refmap));)r=t._string_content.slice(0,n),t._string_content=t._string_content.slice(n),o=!0;if(o&&(i=t._string_content,!we.test(i))){var s=new _("def_link");s._literal=r.match(ve)[1],s._title=e.refmap.get(s._literal).title,s._destination=e.refmap.get(s._literal).destination,t.replace(s)}},canContain:function(){return!1},acceptsLines:!0}},ze=[function(e){return e.indented||62!==Me(e.currentLine,e.nextNonspace)?0:(e.advanceNextNonspace(),e.advanceOffset(1,!1),Fe(Me(e.currentLine,e.offset))&&e.advanceOffset(1,!0),e.closeUnmatchedBlocks(),e.addChild("block_quote",e.nextNonspace),1)},function(e){var t;if(!e.indented&&(t=e.currentLine.slice(e.nextNonspace).match(Ae))){e.advanceNextNonspace(),e.advanceOffset(t[0].length,!1),e.closeUnmatchedBlocks();var n=e.addChild("heading",e.nextNonspace);return n._level=t[0].trim().length,n._string_content=e.currentLine.slice(e.offset).replace(/^[ \t]*#+[ \t]*$/,"").replace(/[ \t]+#+[ \t]*$/,""),e.advanceOffset(e.currentLine.length-e.offset),2}return 0},function(e){var t;if(!e.indented&&(t=e.currentLine.slice(e.nextNonspace).match(De))){var n=t[0].length;e.closeUnmatchedBlocks();var r=e.addChild("code_block",e.nextNonspace);return r._isFenced=!0,r._fenceLength=n,r._fenceChar=t[0][0],r._fenceOffset=e.indent,e.advanceNextNonspace(),e.advanceOffset(n,!1),2}return 0},function(e,t){if(!e.indented&&60===Me(e.currentLine,e.nextNonspace)){var n=e.currentLine.slice(e.nextNonspace),r=void 0;for(r=1;r<=7;r++){if(ye[r].test(n)&&(r<7||"paragraph"!==t.type))return e.closeUnmatchedBlocks(),e.addChild("html_block",e.offset)._htmlBlockType=r,2}}return 0},function(e,t){var n;if(!e.indented&&"paragraph"===t.type&&(n=e.currentLine.slice(e.nextNonspace).match(Se))){e.closeUnmatchedBlocks();for(var r=void 0;91===Me(t._string_content,0)&&(r=e.inlineParser.parseReference(t._string_content,e.refmap));)t._string_content=t._string_content.slice(r);if(t._string_content.length>0){var i=new _("heading",t.sourcepos);return i._level="="===n[0][0]?1:2,i._string_content=t._string_content,t.insertAfter(i),t.unlink(),e.tip=i,e.advanceOffset(e.currentLine.length-e.offset,!1),2}return 0}return 0},function(e,t){var n,r;if("paragraph"===t.type){var i=t._string_content.split("\n"),o=i[i.length-2];if(!e.indented&&"paragraph"===t.type&&(n=o.match(Oe))&&(r=e.currentLine.slice(e.nextNonspace).match(Le))&&n.length===r.length){e.closeUnmatchedBlocks();for(var s=new _("table",t.sourcepos),a=e.currentLine.split("|"),l=[],d=1;d<a.length-1;d++){var c=a[d].trim();":"===c[0]&&":"===c[c.length-1]?l.push("center"):":"===c[0]?l.push("left"):":"===c[c.length-1]?l.push("right"):l.push(null)}s._info={styles:l};var h=new _("thead",t.sourcepos);s.appendChild(h);var p=new _("tr",t.sourcepos);h.appendChild(p),a=n.input.split("|");for(d=1;d<a.length-1;d++){var u=new _("th",t.sourcepos);u._info={style:s._info.styles[d-1]},u._string_content=a[d],p.appendChild(u)}var f=new _("tbody",t.sourcepos);return s.appendChild(f),t.insertAfter(s),t._string_content=t._string_content.slice(0,t._string_content.length-n.input.length-1),e.tip=s,e.advanceOffset(e.currentLine.length-e.offset,!1),2}}return 0},function(e,t){var n;if(!e.indented&&(n=e.currentLine.slice(e.nextNonspace).match(Ee)))for(var r=e.currentLineNumbar+1,i="";r<e.lineLength;r++){if(e.lines[r].match(Ee)){var o=n[0].length;return e.closeUnmatchedBlocks(),e.addChild("math_block",e.nextNonspace)._literal=i,e.advanceNextNonspace(),e.advanceOffset(o,!1),e.currentLineNumbar=r,3}i+=e.lines[r]+"\n"}return 0},function(e){if(!e.indented&&xe.test(e.currentLine.slice(e.nextNonspace))){var t=e.currentLine.slice(e.nextNonspace);return e.closeUnmatchedBlocks(),e.addChild("thematic_break",e.nextNonspace).attrs.set("art-marker",t),e.advanceOffset(e.currentLine.length-e.offset,!1),2}return 0},function(e,t){var n,r,i;return e.indented&&"list"!==t.type||!(n=function(e,t){var n,r,i,o,s=e.currentLine.slice(e.nextNonspace),a={type:null,tight:!0,bulletChar:null,start:null,delimiter:null,padding:null,markerOffset:e.indent};if(e.indent>=4)return null;if(n=s.match(ke))a.type="bullet",a.bulletChar=n[0][0];else{if(!(n=s.match(Ne))||"paragraph"===t.type&&1!=n[1])return null;a.type="ordered",a.start=parseInt(n[1]),a.delimiter=n[2]}if(-1!==(r=Me(e.currentLine,e.nextNonspace+n[0].length))&&9!==r&&32!==r)return null;if("paragraph"===t.type&&!e.currentLine.slice(e.nextNonspace+n[0].length).match(we))return null;e.advanceNextNonspace(),e.advanceOffset(n[0].length,!0),i=e.column,o=e.offset;do{e.advanceOffset(1,!0),r=Me(e.currentLine,e.offset)}while(e.column-i<5&&Fe(r));var l=-1===Me(e.currentLine,e.offset),d=e.column-i;return d>=5||d<1||l?(a.padding=n[0].length+1,e.column=i,e.offset=o,Fe(Me(e.currentLine,e.offset))&&e.advanceOffset(1,!0)):a.padding=n[0].length+d,a}(e,t))?0:(e.closeUnmatchedBlocks(),"list"===e.tip.type&&(r=t._listData,i=n,r.type===i.type&&r.delimiter===i.delimiter&&r.bulletChar===i.bulletChar)||((t=e.addChild("list",e.nextNonspace))._listData=n),(t=e.addChild("item",e.nextNonspace))._listData=n,1)},function(e){return e.indented&&"paragraph"!==e.tip.type&&!e.blank?(e.advanceOffset(4,!0),e.closeUnmatchedBlocks(),e.addChild("code_block",e.offset),2):0}],$e=function(){function e(e){this.blocks=He,this.blockStarts=ze,this.doc=new _("document",[[1,1],[0,0]]),this.tip=this.doc,this.oldtip=this.doc,this.currentLine="",this.lineNumber=0,this.offset=0,this.column=0,this.nextNonspace=0,this.nextNonspaceColumn=0,this.indent=0,this.indented=!1,this.blank=!1,this.partiallyConsumedTab=!1,this.allClosed=!0,this.lastMatchedContainer=this.doc,this.refmap=new Map,this.lastLineLength=0,this.inlineParser=new be(e),this.options=e||{}}return e.prototype.findNextNonspace=function(){for(var e,t=this.currentLine,n=this.offset,r=this.column;""!==(e=t.charAt(n));)if(" "===e)n++,r++;else{if("\t"!==e)break;n++,r+=4-r%4}this.blank="\n"===e||"\r"===e||""===e,this.nextNonspace=n,this.nextNonspaceColumn=r,this.indent=this.nextNonspaceColumn-this.column,this.indented=this.indent>=4},e.prototype.advanceOffset=function(e,t){void 0===t&&(t=null);for(var n,r,i,o=this.currentLine;e>0&&(i=o[this.offset]);)"\t"===i?(n=4-this.column%4,t?(this.partiallyConsumedTab=n>e,r=n>e?e:n,this.column+=r,this.offset+=this.partiallyConsumedTab?0:1,e-=r):(this.partiallyConsumedTab=!1,this.column+=n,this.offset+=1,e-=1)):(this.partiallyConsumedTab=!1,this.offset+=1,this.column+=1,e-=1)},e.prototype.advanceNextNonspace=function(){this.offset=this.nextNonspace,this.column=this.nextNonspaceColumn,this.partiallyConsumedTab=!1},e.prototype.addLine=function(){if(this.partiallyConsumedTab){this.offset+=1;var e=4-this.column%4;this.tip._string_content+=" ".repeat(e)}this.tip._string_content+=this.currentLine.slice(this.offset)+"\n"},e.prototype.addChild=function(e,t){for(;!this.blocks[this.tip.type].canContain(e);)this.finalize(this.tip,this.lineNumber-1);var n=t+1,r=new _(e,[[this.lineNumber,n],[0,0]]);return r._string_content="",this.tip.appendChild(r),this.tip=r,r},e.prototype.incorporateLine=function(e){var t,n,r=!0,i=this.doc;for(this.oldtip=this.tip,this.offset=0,this.column=0,this.blank=!1,this.partiallyConsumedTab=!1,this.lineNumber+=1,-1!==e.indexOf("\0")&&(e=e.replace(/\0/g,"�")),this.currentLine=e;(n=i.lastChild)&&n._open;){switch(i=n,this.findNextNonspace(),this.blocks[i.type].continue(this,i)){case 0:break;case 1:r=!1;break;case 2:return;default:throw"continue returned illegal value, must be 0, 1, or 2"}if(!r){i=i.parent;break}}this.allClosed=i===this.oldtip,this.lastMatchedContainer=i;for(var o="paragraph"!==i.type&&He[i.type].acceptsLines,s=this.blockStarts,a=s.length;!o;){if(this.findNextNonspace(),!this.indented&&!_e.test(e.slice(this.nextNonspace))){this.advanceNextNonspace();break}for(var l=0;l<a;){var d=s[l](this,i);if(1===d){i=this.tip;break}if(2===d){i=this.tip,o=!0;break}if(3===d)return;l++}if(l===a){this.advanceNextNonspace();break}}if(this.allClosed||this.blank||"paragraph"!==this.tip.type){this.closeUnmatchedBlocks(),this.blank&&i.lastChild&&(i.lastChild._lastLineBlank=!0),t=i.type;for(var c=this.blank&&!("block_quote"===t||"code_block"===t&&i._isFenced||"item"===t&&!i.firstChild&&i.sourcepos[0][0]===this.lineNumber),h=i;h;)h._lastLineBlank=c,h=h.parent;this.blocks[t].acceptsLines?(this.addLine(),"html_block"===t&&i._htmlBlockType>=1&&i._htmlBlockType<=5&&Ce[i._htmlBlockType].test(this.currentLine.slice(this.offset))&&(this.lastLineLength=e.length,this.finalize(i,this.lineNumber))):this.offset<e.length&&!this.blank&&(i=this.addChild("paragraph",this.offset),this.advanceNextNonspace(),this.addLine())}else this.addLine();this.lastLineLength=e.length},e.prototype.finalize=function(e,t){var n=e.parent;e._open=!1,e.sourcepos[1]=[t,this.lastLineLength],this.blocks[e.type].finalize(this,e),this.tip=n},e.prototype.processInlines=function(e){var t,n,r,i=e.walker();for(this.inlineParser.refmap=this.refmap,this.inlineParser.options=this.options;n=i.next();)r=(t=n.node).type,n.entering||"paragraph"!==r&&"heading"!==r&&"th"!==r&&"td"!==r||this.inlineParser.parse(t)},e.prototype.closeUnmatchedBlocks=function(){if(!this.allClosed){for(;this.oldtip!==this.lastMatchedContainer;){var e=this.oldtip.parent;this.finalize(this.oldtip,this.lineNumber-1),this.oldtip=e}this.allClosed=!0}},e.prototype.parse=function(e){for(this.doc=new _("document",[[1,1],[0,0]]),this.tip=this.doc,this.refmap=new Map,this.lineNumber=0,this.lastLineLength=0,this.offset=0,this.column=0,this.lastMatchedContainer=this.doc,this.currentLine="",this.lines=e.split(Re),this.lineLength=this.lines.length,10===e.charCodeAt(e.length-1)&&(this.lineLength-=1),this.currentLineNumbar=0;this.currentLineNumbar<this.lineLength;this.currentLineNumbar++)this.incorporateLine(this.lines[this.currentLineNumbar]);for(;this.tip;)this.finalize(this.tip,this.lineLength);return this.processInlines(this.doc),this.doc},e}(),Pe=function(){function e(e){this.parser=new $e(e)}return e.prototype.text=function(e,t){t&&e.prev&&"text"===e.prev.type&&(e._literal=e.prev._literal+e._literal,e.prev.unlink())},e.prototype.image=function(e,t){if(t){var n=new _("span");n.attrs.set("class","art-meta art-hide");var r=new _("text");if(r._literal="![",e.firstChild&&(r._literal+=e.firstChild._literal),e._info&&e._info.type)switch(e._info.type){case"deflink":r._literal+="]["+e._info.destination+"]",e.attrs.set("art-data-ref",e._info.destination),e._destination||(n.attrs.set("class","art-meta"),n.attrs.set("style","color: #c7c7c7"),e._destination="");break;default:r._literal+="]("+e._destination,e._title&&(r._literal+='"'+e._title+'"'),r._literal+=")"}else r._literal+="]("+e._destination,e._title&&(r._literal+='"'+e._title+'"'),r._literal+=")";n.appendChild(r),e.insertBefore(n),e.attrs.set("contenteditable","false")}},e.prototype.heading=function(e,t){if(t){var n=new _("span");n.attrs.set("class","art-meta art-hide");var r=new _("text");r._literal="#".repeat(e._level)+" ",n.appendChild(r),e.prependChild(n);var i=e.getMd();i=i.replace(/\s/g,"-").replace(/\\|\/|#|\:/g,"");var o=new _("link");o.attrs.set("name",i),o.attrs.set("class","art-meta art-shield"),e.prependChild(o)}},e.prototype.link=function(e,t){if(t){var n=new _("span");n.attrs.set("class","art-meta art-hide");var r=new _("text");r._literal="[",n.appendChild(r),e.insertBefore(n),e.attrs.set("class","art-text-double");var i=new _("span");i.attrs.set("class","art-meta art-hide");var o=new _("text");if(e._info&&e._info.type)switch(e._info.type){case"deflink":o._literal="]["+e._info.destination+"]",e._destination="#",e.attrs.set("art-data-ref",e._info.destination);break;case"autolink":r._literal="<",n.attrs.set("class","art-meta"),o._literal=">",i.attrs.set("class","art-meta");break;default:o._literal="]("+e._destination+")"}else o._literal="]("+e._destination+")";i.appendChild(o),e.insertAfter(i)}},e.prototype.code=function(e,t){if(t){var n=new _("span");n.attrs.set("class","art-meta art-hide");var r=new _("text");r._literal="`",n.appendChild(r),e.insertBefore(n),e.attrs.set("class","art-text-double"),(n=new _("span")).attrs.set("class","art-meta art-hide"),(r=new _("text"))._literal="`",n.appendChild(r),e.insertAfter(n)}},e.prototype.html_inline=function(e,t){if(t){var n=new RegExp("^<("+O+")("+S+"*)\\s*/?>"),r=new RegExp("^</("+O+")\\s*[>]"),i=void 0,o=Object();if(i=e._literal.match(n)){o.name=i[1],o.open=!0,o.attrs=new Map,o.node=e;for(var s=void 0;s=i[2].match(/\s*(.*?)="(.*?)"/);)o.attrs.set(s[1],s[2]),i[2]=i[2].replace(s[0],"");this.html_inlines.push(o)}else if(i=e._literal.match(r))for(var a=i[1],l=this.html_inlines.length-1;l>=0;l--)if(e.parent,this.html_inlines[l].node.parent,a===this.html_inlines[l].name){var d=new _(a);d.attrs=this.html_inlines[l].attrs;for(var c=e.prev,h=void 0;c&&c!==this.html_inlines[l].node;)h=c.prev,d.prependChild(c),c=h;e.insertBefore(d),e.attrs.set("class","art-hide"),this.html_inlines[l].node.attrs.set("class","art-hide");var p=d.attrs.get("class");p?d.attrs.set("class",p+" art-text-double"):d.attrs.set("class","art-text-double");break}}},e.prototype.item=function(e,t){t&&e.firstChild&&"item_checkbox"===e.firstChild.type&&(e.attrs.set("class","art-md-item-checkbox"),e.firstChild.attrs.delete("disabled"))},e.prototype.math=function(e,t){if(t){var n=new _("span");n.attrs.set("class","art-meta art-hide");var r=new _("text");r._literal="$",n.appendChild(r),e.insertBefore(n),(n=new _("span")).attrs.set("class","art-meta art-hide"),(r=new _("text"))._literal="$",n.appendChild(r),e.insertAfter(n),(n=new _("span")).attrs.set("class","art-text-double"),e.replace(n);for(var i=e.firstChild,o="";i;)o+=i._literal,i=i.next;var s=new _("art_tool");s.attrs.set("--tool","math"),s.attrs.set("--math",o),n.appendChild(s),e.attrs.set("class","art-text-parent art-md-math"),n.appendChild(e)}},e.prototype.emph=function(e,t){if(t){if("strong"===e.firstChild.type)return;var n="strong"===e.firstChild.type?e.firstChild.attrs.get("art-marker"):e.attrs.get("art-marker"),r=new _("span");r.attrs.set("class","art-meta art-hide");var i=new _("text");i._literal=n,r.appendChild(i),e.insertBefore(r),e.attrs.set("class","art-text-double"),(r=new _("span")).attrs.set("class","art-meta art-hide"),(i=new _("text"))._literal=n,r.appendChild(i),e.insertAfter(r)}},e.prototype.strong=function(e,t){if(t){var n=new _("span");n.attrs.set("class","art-meta art-hide");var r=new _("text");r._literal=e.attrs.get("art-marker"),n.appendChild(r),e.insertBefore(n),e.attrs.set("class","art-text-double"),(n=new _("span")).attrs.set("class","art-meta art-hide"),(r=new _("text"))._literal=e.attrs.get("art-marker"),n.appendChild(r),e.insertAfter(n)}},e.prototype.delete=function(e,t){if(t){var n=new _("span");n.attrs.set("class","art-meta art-hide");var r=new _("text");r._literal=e.attrs.get("art-marker"),n.appendChild(r),e.insertBefore(n),e.attrs.set("class","art-text-double"),(n=new _("span")).attrs.set("class","art-meta art-hide"),(r=new _("text"))._literal=e.attrs.get("art-marker"),n.appendChild(r),e.insertAfter(n)}},e.prototype.interactionParse=function(e){var t,n,r=e.walker();for(this.html_inlines=[];t=r.next();)this[n=t.node.type]&&this[n](t.node,t.entering)},e.prototype.parse=function(e){var t=this.parser.parse(e);return this.interactionParse(t),t},e.prototype.inlineParse=function(e){var t;return"string"==typeof e?(t=new _("paragraph"))._string_content=e:t=e,this.parser.inlineParser.parse(t),this.interactionParse(t),t},e}(),je=/^`{3,}(?!.*`)|^~{3,}/,Ie=/^[*+-]/,qe=/^(\d{1,9})([.)])/,Ue=/^#{1,6}/,Ve=/^(?:(?:\*[ \t]*){3,}|(?:_[ \t]*){3,}|(?:-[ \t]*){3,})[ \t]*$/,Ze=/^>/,Ke=/^\|(.*?\|)+/,Je=/^\[((?:[^\\\[\]]|\\.){0,1000})\]/,Ge=function(){function e(e){this.artRender=e,this.renderFlag=!0,this.operation=this.artRender.operation,this.cursor=this.artRender.cursor,this.parser=this.artRender.parser}return e.prototype.render=function(e,t,n){this.behavior={key:e,type:t};var r=!0;if(this.cursor.getSelection(),console.log(this.behavior),"keydown"==t)switch(e){case"Backspace":r=this.backspace();break;case"Enter":r=this.enter();break;default:r=this.keydown()}else if("keyup"==t)switch(e){case"Control":case"Shift":case"Enter":break;case"Backspace":default:r=this.keyup()}return this.cursor.setSelection(),this.artRender.artText.get("$eventCenter").emit("artRender-render"),r},e.prototype.updateNode=function(e,t){if(o.b.hasClass(e,"art-md-html-inline"))t._literal!=e.innerText&&((h=new _("html_inline"))._literal=e.innerText,h.dom=t.dom,this.operation.replace(h,t,!1),this.operation.update());else if("def_link"!==t.type)if("softbreak"===t.type&&o.b.hasClass(e,"art-md-softbreak")){if("\n"!==e.innerText){(h=new _("text"))._literal=e.innerText;var n=new _("softbreak");this.operation.replace(n,t),this.operation.insertAfter(h,n),this.operation.update(),this.cursor.pos.inAnchorOffset++,this.cursor.pos.inFocusOffset++}}else if("text"===t.type&&e instanceof Text){t._literal&&t._literal!=e.data&&((h=new _("text"))._literal=e.data,h.dom=t.dom,t.dom=new Text(t._literal),this.operation.replace(h,t,!1),this.operation.update())}else{if("text"===t.type||"softbreak"===t.type)return this.operation.remove(t,!1),void this.operation.update();if(e instanceof Text){h=void 0;return"\n"===e.data?h=new _("softbreak"):(h=new _("text"))._literal=e.data,h.dom=e,this.operation.insertBefore(h,t,!1),void this.operation.update()}for(var r,i=t.firstChild,s=0,a=e.childNodes.length;s<a&&i;s++,i=r)r=i.next,this.updateNode(e.childNodes[s],i);for(;s<a;s++){if(e.childNodes[s]instanceof Text)(c=new _("text")).dom=e.childNodes[s],c._literal=e.childNodes[s].data,this.operation.appendChild(t,c,!1),this.operation.update()}for(;i;i=r)r=i.next,this.operation.remove(i,!1),this.operation.update()}else{var l=t.getMd(),d=new Map;if((l=l.substring(0,l.length-1))!==e.innerText){if(this.artRender.refmap.delete(l.match(Je)[1]),this.parser.parser.inlineParser.parseReference(e.innerText,d))return(h=new _("def_link"))._literal=e.innerText.match(Je)[1],h._title=d.get(h._literal).title,h._destination=d.get(h._literal).destination,this.artRender.refmap.set(h._literal,d.get(h._literal)),this.operation.replace(h,t),this.operation.update(),this.artRender.refmap.set(h._literal,d.get(h._literal)),h;var c,h=new _("paragraph");return(c=new _("text"))._literal=e.innerText,h.appendChild(c),this.operation.replace(h,t),this.operation.update(),h}}},e.prototype.keyup=function(){var e=this.cursor.pos;if(e&&e.rowAnchorOffset>-1){for(var t=this.artRender.doc.firstChild,n=e.rowAnchorOffset;-1!=--n;)t=t.next;switch(t.type){case"thematic_break":return!1;case"code_block":this.code_block(t,e.rowNode);break;case"math_blcok":this.math_block(t,e.rowNode);break;case"html_block":this.html_block(t,e.rowNode);break;case"def_link":case"paragraph":case"heading":this.paragraph(t,e.rowNode);break;case"list":this.list(t,e.rowNode);break;case"block_quote":this.block_quote(t,e.rowNode);break;case"table":this.table(t,e.rowNode)}}return!0},e.prototype.keydown=function(){var e=this.cursor.pos;if(e&&e.rowAnchorOffset>-1){for(var t=this.artRender.doc.firstChild,n=e.rowAnchorOffset;-1!=--n;)t=t.next;if("thematic_break"==t.type)return!1}return!0},e.prototype.backspace=function(){var e=this.cursor.pos;if(e&&-1!==e.rowAnchorOffset){for(var t=this.artRender.doc.firstChild,n=e.rowAnchorOffset,r=void 0;-1!=--n;)t=t.next;var i=this.artRender.dom.childNodes[e.rowAnchorOffset];if(o.b.hasClass(i,"art-md-MathBlock")){if("\n"==e.rowNode.innerHTML)return this.operation.remove(t),this.operation.update(),!1;if(0===e.rowNodeAnchorOffset)return!1}else if(o.b.hasClass(i,"art-md-CodeBlock")){if("\n"==e.rowNode.innerText)return this.operation.remove(t),this.operation.update(),!1;if(0===e.rowNodeAnchorOffset)return!1}else{if(o.b.hasClass(i,"art-md-Hr"))return(r=new _("paragraph")).appendChild(new _("linebreak")),this.operation.replace(r,t),this.operation.update(),!1;if(!("P"!==e.rowNode.nodeName||e.rowNode.previousSibling&&"INPUT"!==e.rowNode.previousSibling.nodeName||1!==e.rowNode.childNodes.length||"BR"!==e.rowNode.firstChild.nodeName||"LI"!==e.rowNode.parentElement.nodeName)){for(var s,a=t.walker(),l=void 0;s=a.next();)if(s.entering&&s.node.dom===e.rowNode){l=s.node;break}return l.parent.prev?((r=new _("paragraph")).appendChild(new _("linebreak")),this.operation.appendChild(l.parent.prev,r),this.operation.remove(l.parent),this.operation.update(),g.setCursor(r.dom,0)):((r=new _("paragraph")).appendChild(new _("linebreak")),this.operation.insertBefore(r,l.parent.parent),this.operation.remove(l.parent),this.operation.update(),g.setCursor(r.dom,0)),!1}if("P"===e.rowNode.nodeName&&1===e.rowNode.childNodes.length&&"BR"===e.rowNode.firstChild.nodeName&&1===e.rowNode.parentNode.childNodes.length&&"BLOCKQUOTE"===e.rowNode.parentNode.nodeName){var d;for(a=t.walker(),l=void 0;d=a.next();)if(d.entering&&d.node.dom===e.rowNode){l=d.node;break}return(r=new _("paragraph")).appendChild(new _("linebreak")),this.operation.replace(r,l.parent),this.operation.update(),g.setCursor(r.dom,0),!1}if(e.selection.isCollapsed&&0===e.inAnchorOffset&&(["paragraph","heading"].includes(t.type)||o.b.hasClass(i,"art-md-DefLink"))&&t.prev){if("thematic_break"===t.prev.type)return this.operation.remove(t.prev),this.operation.update(),this.cursor.pos.rowAnchorOffset--,this.cursor.pos.rowFocusOffset--,!1;if(["paragraph","heading"].includes(t.prev.type)||o.b.hasClass(i.previousSibling,"art-md-DefLink")){var c=t.getMd();c.length&&10===c.charCodeAt(c.length-1)&&(c=c.substring(0,c.length-1));var h=new _("text");return h._literal=c,this.operation.appendChild(t.prev,h),this.operation.remove(t),this.operation.update(),g.setCursor(h.dom,0),this.cursor.getSelection(),!1}}else console.log("wu ------------------------- keydown back",t)}}return!0},e.prototype.enter=function(){var e=this.cursor.pos;if(e){var t=e.rowAnchorOffset;if(-1==t)return!1;for(var n=this.artRender.doc.firstChild,r=t,i=void 0;-1!=--r;)n=n.next;var s=n.getMd();s.length&&10===s.charCodeAt(s.length-1)&&(s=s.substring(0,s.length-1));var a=this.artRender.dom.childNodes[e.rowAnchorOffset];if(o.b.hasClass(a,"art-md-Hr"))return(i=new _("paragraph")).appendChild(new _("linebreak")),this.operation.replace(i,n),this.operation.update(),g.setCursor(i.dom,0),!1;if(o.b.hasClass(a,"art-md-DefLink")){var l=void 0,d=void 0,c=void 0;if(e.inAnchorOffset===s.length)(i=new _("paragraph")).appendChild(new _("linebreak")),this.operation.insertAfter(i,n);else if(e.inAnchorOffset){l=s.substring(e.inAnchorOffset),i=this.parser.inlineParse(l),this.operation.insertAfter(i,n);var h=new Map;l=s.substring(0,e.inAnchorOffset),this.parser.parser.inlineParser.parseReference(l,h)?((c=new _("def_link"))._literal=l.match(Je)[1],c._title=h.get(c._literal).title,c._destination=h.get(c._literal).destination,this.artRender.refmap.set(c._literal,h.get(c._literal))):(this.artRender.refmap.delete(s.match(Je)[1]),c=this.parser.inlineParse(l)),this.operation.replace(c,n)}else(i=new _("paragraph")).appendChild(new _("linebreak")),this.operation.insertBefore(i,n);return this.operation.update(),g.setCursor(i.dom,0),this.cursor.getSelection(),!1}if("P"===a.nodeName&&Ve.test(s))return(i=new _("thematic_break")).attrs.set("art-marker",s),this.operation.replace(i,n),this.operation.update(),this.cursor.pos.inFocusOffset=0,this.cursor.pos.inAnchorOffset=0,!1;if("P"===a.nodeName&&je.test(s)){(i=new _("code_block")).attrs.set("art-marker",s.match(je)[0]),i._literal="\n",this.operation.replace(i,n);var p=new _("art_tool");p.attrs.set("--tool","code_block"),this.operation.insertBefore(p,i),i._info=s.substring(s.match(je)[0].length);var u=n._info?n._info.split(/\s+/):[];if(u.length>0&&u[0].length>0&&"flow"==u[0]){var f=new _("art_tool");f.attrs.set("--tool","code_block_flow"),this.operation.insertAfter(f,i)}return this.operation.update(),this.cursor.pos.inFocusOffset=0,this.cursor.pos.inAnchorOffset=0,!1}if(e.rowNode&&["TD","TH"].includes(e.rowNode.nodeName)){if(e.rowNode.parentElement.nextSibling||"TH"===e.rowNode.nodeName){for(var m=0,b=e.rowNode.previousSibling;b;)m+=1,b=b.previousSibling;"TH"===e.rowNode.nodeName?g.setCursor(e.rowNode.parentElement.parentElement.nextSibling.firstChild.childNodes[m],0):g.setCursor(e.rowNode.parentElement.nextSibling.childNodes[m],0)}else g.setCursor(n.next.dom,0);return!1}if("P"===a.nodeName&&Ke.test(s)){var v=new _("table"),y=new _("thead"),C=new _("tbody");v.appendChild(y),v.appendChild(C);for(var x=new _("tr"),w=new _("tr"),k=s.split("|"),N=1,A=k.length-1;N<A;N++){var D=new _("th");D._string_content=k[N],this.parser.inlineParse(D),x.appendChild(D),(i=new _("td")).appendChild(new _("linebreak")),w.appendChild(i)}return y.appendChild(x),C.appendChild(w),this.operation.insertAfter(v,n),this.operation.remove(n),this.operation.update(),g.setCursor(w.firstChild.dom,0),!1}if(e.rowNode&&"P"===e.rowNode.nodeName&&"BLOCKQUOTE"===e.rowNode.parentNode.nodeName){for(var E,T=n.walker(),L=null;E=T.next();)if(E.entering&&E.node.dom===e.rowNode){L=E.node;break}if(1===e.rowNode.childNodes.length&&"BR"===e.rowNode.childNodes[0].nodeName){if(L.parent.lastChild!==L){for(c=new _("block_quote"),b=L.next;b;)this.operation.remove(b),c.appendChild(b),b=b.next;this.operation.insertAfter(c,L.parent)}(i=new _("paragraph")).appendChild(new _("linebreak")),this.operation.insertAfter(i,L.parent),this.operation.remove(L),this.operation.update(),g.setCursor(i.dom,0)}else{(s=L.getMd()).length&&10===s.charCodeAt(s.length-1)&&(s=s.substring(0,s.length-1)),n=L;c=void 0;var O=s.substring(0,e.rowNodeAnchorOffset);d=void 0;O?(c=this.parser.inlineParse(O),this.operation.replace(c,n)):((c=new _("paragraph")).appendChild(new _("linebreak")),this.operation.insertBefore(c,n));var S=void 0,R=s.substring(e.rowNodeAnchorOffset);R?S=this.parser.inlineParse(R):(S=new _("paragraph")).appendChild(new _("linebreak")),this.operation.insertAfter(S,c),this.operation.update(),g.setCursor(S.dom,0)}return this.artRender.cursor.getSelection(),!1}if(e.rowNode&&"P"===e.rowNode.nodeName&&"LI"===e.rowNode.parentNode.nodeName){var F;for(T=n.walker(),L=null;F=T.next();)if(F.entering&&F.node.dom===e.rowNode){L=F.node;break}if(1===e.rowNode.childNodes.length&&"BR"===e.rowNode.childNodes[0].nodeName){if(L.parent.parent.lastChild!==L.parent){(c=new _("list")).listType=L.parent.parent.listType;b=L.parent.next;for(var M=void 0;b;)M=b.next,this.operation.remove(b),c.appendChild(b),b=M;this.operation.insertAfter(c,L.parent.parent)}if(L.prev&&"item_checkbox"!==L.prev.type)(i=new _("item")).appendChild(new _("paragraph")),i.firstChild.appendChild(new _("linebreak")),this.operation.insertAfter(i,L.parent),this.operation.remove(L),this.operation.update(),g.setCursor(i.dom,0);else switch(L.parent.parent.parent.type){case"document":case"block_quote":case"item":(i=new _("paragraph")).appendChild(new _("linebreak")),this.operation.insertAfter(i,L.parent.parent),this.operation.remove(L.parent),this.operation.update(),g.setCursor(i.dom,0);break;default:throw"error:"+L.parent.parent.parent.type}this.artRender.cursor.getSelection()}else if(L.prev&&"item_checkbox"!==L.prev.type){(s=L.getMd()).length&&10===s.charCodeAt(s.length-1)&&(s=s.substring(0,s.length-1));c=void 0,l=void 0;e.rowNodeAnchorOffset===s.length?((c=new _("paragraph")).appendChild(new _("linebreak")),this.operation.insertAfter(c,L)):e.rowNodeAnchorOffset?(l=s.substring(e.rowNodeAnchorOffset),c=this.parser.inlineParse(l),this.operation.insertAfter(c,L),l=s.substring(0,e.rowNodeAnchorOffset),i=this.parser.inlineParse(l),this.operation.replace(i,L)):((c=new _("paragraph")).appendChild(new _("linebreak")),this.operation.insertBefore(c,L),c=L),this.operation.update(),g.setCursor(c.dom,0)}else{c=void 0,l=void 0;if((s=L.getMd()).length&&10===s.charCodeAt(s.length-1)&&(s=s.substring(0,s.length-1)),i=new _("item"),L.prev&&"item_checkbox"===L.prev.type){i.attrs.set("class","art-md-item-checkbox");var B=new _("item_checkbox");B.attrs.set("type","checkbox"),e.rowNode.previousSibling.checked&&B.attrs.set("checked","checked"),i.appendChild(B)}e.rowNodeAnchorOffset===s.length?((c=new _("paragraph")).appendChild(new _("linebreak")),i.appendChild(c),this.operation.insertAfter(i,L.parent),i=c):e.rowNodeAnchorOffset?(l=s.substring(e.rowNodeAnchorOffset),c=this.parser.inlineParse(l),i.appendChild(c),this.operation.insertAfter(i,L.parent),i=c,l=s.substring(0,e.rowNodeAnchorOffset),c=this.parser.inlineParse(l),this.operation.replace(c,L)):((c=new _("paragraph")).appendChild(new _("linebreak")),i.appendChild(c),this.operation.insertBefore(i,L),i=c),this.operation.update(),g.setCursor(i.dom,0)}return!1}if(o.b.hasClass(a,"art-md-CodeBlock")){var H=e.rowNode.innerText,z=e.rowNodeAnchorOffset;return H=H.substring(0,z)+"\n"+H.substring(z),(i=new _("code_block"))._info=n._info,i._literal=H,this.operation.replace(i,n),this.operation.update(),z+=1,g.setCursor.apply(g,g.getNodeAndOffset(i.dom.childNodes[1].firstChild,z)),this.artRender.cursor.getSelection(),!1}if(o.b.hasClass(a,"art-md-MathBlock")){H=e.rowNode.innerText,z=e.rowNodeAnchorOffset;return H=H.substring(0,z)+"\n"+H.substring(z),(i=new _("math_block"))._literal=H,this.operation.replace(i,n),this.operation.update(),z+=1,i.dom.firstChild.classList.replace("art-display-none","art-display"),g.setCursor.apply(g,g.getNodeAndOffset(i.dom.firstChild.childNodes[1],z)),this.artRender.cursor.getSelection(),!1}if(o.b.hasClass(a,"art-md-HtmlBlock")){H=e.rowNode.innerText,z=e.rowNodeAnchorOffset;return H=H.substring(0,z)+"\n"+H.substring(z),(i=new _("html_block"))._literal=H,this.operation.replace(i,n),this.operation.update(),z+=1,i.dom.firstChild.classList.replace("art-display-none","art-display"),g.setCursor.apply(g,g.getNodeAndOffset(i.dom.firstChild,z)),this.artRender.cursor.getSelection(),!1}if("P"===a.nodeName||/^H[1-6]$/.test(a.nodeName)){l=void 0,d=void 0,c=void 0;return e.inAnchorOffset===s.length?((i=new _("paragraph")).appendChild(new _("linebreak")),this.operation.insertAfter(i,n)):e.inAnchorOffset?(l=s.substring(e.inAnchorOffset),i=this.parser.inlineParse(l),this.operation.insertAfter(i,n),(d=(l=s.substring(0,e.inAnchorOffset)).match(Ue))&&32==l.charCodeAt(d[0].length)?((c=new _("heading"))._level=d[0].length,c._string_content=l.substring(d[0].length+1),this.parser.parser.inlineParser.parse(c),this.parser.interactionParse(c)):c=this.parser.inlineParse(l),this.operation.replace(c,n)):((i=new _("paragraph")).appendChild(new _("linebreak")),this.operation.insertBefore(i,n)),this.operation.update(),g.setCursor(i.dom,0),this.cursor.getSelection(),!1}console.log("enter wu------------------",a)}return!0},e.prototype.paragraph=function(e,t){var n,r,i=this.updateNode(t,e);i&&(e=i);var o,s,a=e.getMd(),l=new Map;if(a.length&&10===a.charCodeAt(a.length-1)&&(a=a.substring(0,a.length-1)),""==a||"\n"==a||je.test(a)||Ve.test(a))return null;if((o=a.match(Ie))&&32==a.charCodeAt(1))(s=new _("list")).listType="bullet",s.appendChild(new _("item")),(a=a.substring(2))?s.firstChild.appendChild(this.parser.inlineParse(a)):(s.firstChild.appendChild(new _("paragraph")),s.firstChild.firstChild.appendChild(new _("linebreak"))),this.operation.replace(s,e),this.operation.update(),this.cursor.pos.inFocusOffset-=2,this.cursor.pos.inAnchorOffset-=2;else if((o=a.match(qe))&&32==a.charCodeAt(2))(s=new _("list")).listType="ordered",s.appendChild(new _("item")),(a=a.substring(3))?s.firstChild.appendChild(this.parser.inlineParse(a)):(s.firstChild.appendChild(new _("paragraph")),s.firstChild.firstChild.appendChild(new _("linebreak"))),this.operation.replace(s,e),this.operation.update(),this.cursor.pos.inFocusOffset-=3,this.cursor.pos.inAnchorOffset-=3;else if((o=a.match(Ze))&&32==a.charCodeAt(1))s=new _("block_quote"),(a=a.substring(2))?s.appendChild(this.parser.inlineParse(a)):(s.appendChild(new _("paragraph")),s.firstChild.appendChild(new _("linebreak"))),this.operation.replace(s,e),this.operation.update(),this.cursor.pos.inFocusOffset-=2,this.cursor.pos.inAnchorOffset-=2;else if((o=a.match(Ue))&&32==a.charCodeAt(o[0].length))(s=new _("heading"))._level=o[0].length,s._string_content=a.substring(o[0].length+1),this.parser.parser.inlineParser.parse(s),this.parser.interactionParse(s),this.operation.replace(s,e),this.operation.update();else if(this.parser.parser.inlineParser.parseReference(a,l)){if(!i||i&&"def_link"!==i.type){(s=new _("def_link"))._literal=a.match(Je)[1];var d=s._literal;s._title=null===(n=l.get(d))||void 0===n?void 0:n.title,s._destination=null===(r=l.get(d))||void 0===r?void 0:r.destination,this.artRender.refmap.set(d,l.get(s._literal)),this.operation.replace(s,e),this.operation.update()}}else{var c=this.parser.inlineParse(a);if(10===a.charCodeAt(a.length-1)){var h=new _("softbreak");h.attrs.set("class","art-emptyline"),c.appendChild(h),this.cursor.pos.inFocusOffset++,this.cursor.pos.inAnchorOffset++}this.operation.replace(c,e),this.operation.update()}},e.prototype.list=function(e,t){for(var n,r=e.firstChild;r;)n=r.next,this.item(r,t),r=n},e.prototype.item=function(e,t){for(var n,r=e.firstChild;r;){switch(n=r.next,r.type){case"list":this.list(r,t);break;case"paragraph":r.dom===t&&this.paragraph(r,t);break;case"block_quote":this.block_quote(r,t);break;case"item_checkbox":break;default:throw console.error(r),"Interction class: item 中不存在"+r.type+"类型"}r=n}},e.prototype.block_quote=function(e,t){for(var n,r=e.firstChild;r;){switch(n=r.next,r.type){case"list":this.list(r,t);break;case"paragraph":r.dom===t&&this.paragraph(r,t);break;case"block_quote":this.block_quote(r,t);break;default:throw"Interction class: block_quote 中不存在"+r.type+"类型"}r=n}},e.prototype.table=function(e,t){var n=e;if(e.firstChild.dom===t.parentElement.parentElement)for(var r=e.firstChild.firstChild.firstChild;r;){if(r.dom===t){n=r;break}r=r.next}else{r=e.lastChild.firstChild;for(var i=void 0;r;){for(i=r.firstChild;i;){if(i.dom===t){n=i;break}i=i.next}if(i)break;r=r.next}}this.updateNode(t,n);var o=new _(n.type),s=n.getMd();s.length&&10===s.charCodeAt(s.length-1)&&(s=s.substring(0,s.length-1)),o._string_content=s,this.parser.inlineParse(o),this.operation.replace(o,n),this.operation.update()},e.prototype.code_block=function(e,t){var n=t.firstChild,r=new _("code_block");r._literal=n.innerText,r._info="";var i=n.className.match(/lang-(.*?)(\s|$)/g);i&&i.forEach((function(e){return r._info+=e.substring(5)})),this.operation.replace(r,e),this.operation.update()},e.prototype.math_block=function(e,t){var n=new _("math_block");n._literal=t.innerText,this.operation.replace(n,e),this.operation.update()},e.prototype.html_block=function(e,t){var n=new _("html_block");n._literal=t.innerText,this.operation.replace(n,e),this.operation.update(),n.dom.lastChild.style.display="none",n.dom.firstChild.classList.replace("art-display-none","art-display")},e.prototype.diff=function(e,t){t.isEqual(e)},e}(),Qe=function(){function e(e){this.first=e,this.last=this.first}return e.prototype.append=function(e){this.last.next=e,e.prev=this.last,this.last=e},e}(),Xe=function(e,t,n,r){this.prev=null,this.next=null,this.command=e,this.beNode=n,this.node=t,this.renderFlag=r},Ye=function(){function e(e){this.artRender=e,this.first=null,this.last=null,this.current=null,this.currentNodeHead=null}return e.prototype.addOperationVNode=function(e){this.currentNodeHead?this.currentNodeHead.append(e):this.currentNodeHead=new Qe(e)},e.prototype.execCommand=function(){},e.prototype.insertBefore=function(e,t,n){void 0===n&&(n=!0),this.addOperationVNode(new Xe("insertBefore",e,t,n)),t.insertBefore(e)},e.prototype.insertAfter=function(e,t,n){void 0===n&&(n=!0),this.addOperationVNode(new Xe("insertAfter",e,t,n)),t.insertAfter(e)},e.prototype.remove=function(e,t){void 0===t&&(t=!0),this.addOperationVNode(new Xe("remove",e,null,t)),e.unlink()},e.prototype.replace=function(e,t,n){void 0===n&&(n=!0),this.addOperationVNode(new Xe("replace",e,t,n)),t.replace(e)},e.prototype.appendChild=function(e,t,n){void 0===n&&(n=!0),this.addOperationVNode(new Xe("appendChild",t,e,n)),e.appendChild(t)},e.prototype.update=function(e){if(void 0===e&&(e=!0),this.currentNodeHead){if(this.last?(this.last.next=this.currentNodeHead,this.currentNodeHead.prev=this.last):this.first=this.currentNodeHead,this.last=this.currentNodeHead,this.currentNodeHead=null,e)for(var t=this.last.first,n=void 0;t;)t.renderFlag?(n=null,"appendChild"==t.command?(n=t.node.newDom(),t.beNode.dom.appendChild(t.node.dom)):"replace"==t.command?(n=t.node.newDom(),t.beNode.dom.parentElement.replaceChild(t.node.dom,t.beNode.dom)):"insertBefore"==t.command?(n=t.node.newDom(),t.beNode.dom.parentElement.insertBefore(t.node.dom,t.beNode.dom)):"insertAfter"==t.command?(n=t.node.newDom(),t.beNode.dom.nextElementSibling?t.beNode.dom.parentElement.insertBefore(t.node.dom,t.beNode.dom.nextElementSibling):t.beNode.dom.parentElement.appendChild(t.node.dom)):"remove"===t.command&&t.node.dom.parentElement.removeChild(t.node.dom),n&&n(),t=t.next):t=t.next;this.last.pos=this.artRender.cursor.pos}},e.prototype.redo=function(){if(this.currentNodeHead){this.current&&(this.current.next=this.currentNodeHead,this.currentNodeHead.prev=this.current),this.current=this.currentNodeHead,this.currentNodeHead=null;for(var e=this.last.first,t=void 0;e;)e.renderFlag&&(t=null,"appendChild"==e.command?(t=e.node.setDom(),e.beNode.dom.appendChild(e.node.dom)):"replace"==e.command?(t=e.node.setDom(),e.beNode.dom.parentElement.replaceChild(e.node.dom,e.beNode.dom)):"insertBefore"==e.command?(t=e.node.setDom(),e.beNode.dom.parentElement.insertBefore(e.node.dom,e.beNode.dom)):"insertAfter"==e.command&&(t=e.node.setDom(),e.beNode.dom.nextElementSibling?e.beNode.dom.parentElement.insertBefore(e.node.dom,e.beNode.dom.nextElementSibling):e.beNode.dom.parentElement.appendChild(e.node.dom)),t&&t()),e=e.next;this.last.pos=this.artRender.cursor.pos}},e.prototype.undo=function(){if(this.undoNode(),this.last){console.log(this.last);for(var e=void 0,t=(e=this.last).first;t;)console.log(t.beNode,"----------------------",t.beNode.dom,t.node.dom,t.beNode.dom==t.node.dom),["appendChild","insertBefore","insertAfter"].includes(t.command)?(t.node.dom.removeChild(t.node.dom),t.node.unlink()):"replace"==t.command&&(t.node.dom.parentElement.replaceChild(t.beNode.dom,t.node.dom),t.node.replace(t.beNode)),t=t.next;console.log(e.pos,"----------------------"),e.pos.inAnchorOffset--,e.pos.inFocusOffset--,this.artRender.cursor.setSelection(e.pos),this.last=this.last.prev}},e.prototype.undoNode=function(){if(this.currentNodeHead){for(var e=this.currentNodeHead.first;e;)["appendChild","insertBefore","insertAfter"].includes(e.command)?e.node.unlink():"replace"==e.command&&e.node.replace(e.beNode),e=e.next;this.currentNodeHead=null}},e}(),We=n(2),et=null;function tt(e,t){try{e.innerHTML="",et.parse(t).drawSVG(e),e.previousSibling.style.display="none",e.onclick=function(){console.log(this,this.previousSibling),this.previousSibling.style.display="inherit",g.setCursor(this.previousSibling,0)}}catch(e){console.error("flowchart发生错误:",e)}}var nt={install:function(e,t){t.Tool.loadScript("https://cdnjs.cloudflare.com/ajax/libs/raphael/2.3.0/raphael.min.js",(function(){t.Tool.loadScript("https://cdnjs.cloudflare.com/ajax/libs/flowchart/1.14.0/flowchart.min.js",(function(){et=We.c.flowchart,ft.setPlugin("flowchart",tt)}))}))}},rt=null;function it(e,t,n){if(n&&null!=rt.getLanguage(n))t=rt.highlight(n,t).value;else{var r=rt.highlightAuto(t);t=r.value,e.className.match(r.language)||(e.className+=" "+r.language)}e.innerHTML=t}var ot={install:function(e,t){t.Tool.loadScript("https://libs.cdnjs.net/highlight.js/10.1.2/highlight.min.js",(function(){rt=We.c.hljs,ft.setPlugin("hljs",it)}))}},st=null;function at(e,t){var n="mermaid-"+(new Date).valueOf(),r=document.createElement("div");r.setAttribute("id",n),e.appendChild(r),st.mermaidAPI.render(n,t,(function(t,n){e.innerHTML=t,e.previousSibling.style.display="none",e.onclick=function(){console.log(this,this.previousSibling),this.previousSibling.style.display="inherit",g.setCursor(this.previousSibling,0)}}))}var lt={install:function(e,t){t.Tool.loadScript("https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js",(function(){(st=We.c.mermaid).mermaidAPI.initialize({startOnLoad:!1}),ft.setPlugin("mermaid",at)}))}},dt=null;function ct(e,t){e.innerHTML=dt.renderToString(t,{throwOnError:!1})}var ht={install:function(e,t){t.Tool.loadScript("https://cdn.jsdelivr.net/npm/katex@0.10.1/dist/katex.min.js",(function(){dt=We.c.katex,ft.setPlugin("katex",ct)})),t.Tool.loadCss("https://cdn.jsdelivr.net/npm/katex@0.10.1/dist/katex.min.css")}},pt=function(){function e(){this.refmap=new Map}return e.prototype.setRefMap=function(e){this.refmap=e},e.prototype.set=function(e,t){return document.querySelectorAll('*[art-data-ref="'+e+'"]').forEach((function(e){"IMG"===e.tagName&&(e.previousElementSibling.setAttribute("class","art-meta art-hide"),e.previousElementSibling.setAttribute("style",""),e.setAttribute("src",t.destination))})),this.refmap.set(e,t)},e.prototype.get=function(e){return this.refmap.get(e)},e.prototype.has=function(e){return this.refmap.has(e)},e.prototype.delete=function(e){return document.querySelectorAll('*[art-data-ref="'+e+'"]').forEach((function(e){"IMG"===e.tagName&&(e.previousElementSibling.setAttribute("class","art-meta"),e.previousElementSibling.setAttribute("style","color: #c7c7c7"),e.setAttribute("src",""))})),this.refmap.delete(e)},e}(),ut=function(){function e(t){this.artText=t,this.cursor=null,this.abbrName=" MD ",this.dom=document.createElement("div"),this.dom.setAttribute("class","art-render-art");var n=document.createElement("p");n.appendChild(document.createElement("br")),this.dom.appendChild(n),this.cursor=new g(this.dom),this.tableMoreTool=new D,this.renderEvent=new A(this),this.operation=new Ye(this),this.parser=new Pe({}),this.interaction=new Ge(this),this.refmap=new pt,this.doc=new _("document",[[1,1],[0,0]]),this.doc.dom=this.dom,e.artRenders.push(this)}return e.setPlugin=function(t,n){e.plugins[t]=n;for(var r=0,i=e.artRenders;r<i.length;r++){i[r].interaction.render(null,"keyup")}},e.prototype.createDom=function(){return this.artText.get("$tool").add({dom:this.tableMoreTool.createDom()}),this.dom},e.prototype.open=function(){this.dom.style.display="inherit",this.renderEvent.attachAllEvent()},e.prototype.close=function(){this.renderEvent.detachAllEvent(),this.dom.style.display="none"},e.prototype.getMd=function(){for(var e="",t=this.doc.firstChild;t;){var n=t.getMd();n&&(e+=n+"\n"),t=t.next}return e},e.prototype.setMd=function(e){this.doc=this.parser.parse(e),this.refmap.setRefMap(this.parser.parser.refmap),this.doc.dom=this.dom,this.doc.dom.innerHTML="";for(var t,n=this.doc.firstChild;n;)t=n.newDom(),this.doc.dom.appendChild(n.dom),t&&null!==t&&t(),n=n.next;console.log(this.doc),this.artText.get("$eventCenter").emit("artRender-render")},e.prototype.attachAllEvent=function(){this.renderEvent.attachAllEvent()},e.prototype.detachAllEvent=function(){console.log("sdad",this),this.renderEvent.detachAllEvent()},e.prototype.deleteSelectNode=function(){var e,t;this.cursor.getSelection();var n=this.cursor.pos;if(n.selection.isCollapsed)return!1;var r=n.rowAnchorOffset,i=n.rowFocusOffset,o=n.inAnchorOffset,s=n.inFocusOffset;r>i&&(r=(e=[i,r])[0],i=e[1],o=(t=[s,o])[0],s=t[1]);for(var a=this.doc.firstChild,l=0;a&&!(l>i);){if(i===r){a.getMd().substring(o,s);break}l==r?a.getMd().substring(o)+"\n":l===i?a.getMd().substring(0,s)+"\n":l>r&&a.getMd()+"\n",l++,a=a.next}return!1},e.prototype.getSelectNodeMd=function(){var e,t;this.cursor.getSelection();var n=this.cursor.pos,r=n.rowAnchorOffset,i=n.rowFocusOffset,o=n.inAnchorOffset,s=n.inFocusOffset;r>i&&(r=(e=[i,r])[0],i=e[1],o=(t=[s,o])[0],s=t[1]);for(var a=this.doc.firstChild,l=0,d="";a&&!(l>i);){if(i===r){d+=a.getMd().substring(o,s);break}l==r?d+=a.getMd().substring(o)+"\n":l===i?d+=a.getMd().substring(0,s)+"\n":l>r&&(d+=a.getMd()+"\n"),l++,a=a.next}return d},e.plugins={hljs:null,katex:null,flowchart:null,mermaid:null},e.artRenders=[],e}(),ft=ut,mt={install:function(e,t){i.b.use(nt),i.b.use(ot),i.b.use(lt),i.b.use(ht),t.container.bind("$artRender",ut,[{get:"art"}],!0)},created:function(e,t){e.get("$editor").addRender("artRender",e.get("$artRender")),e.get("$editor").defaultRender=e.get("$artRender")}},gt=function(){function e(e){this.abbrName="Text",this.DOMEvents=[],this.artText=e}return e.prototype.createDom=function(){return this.dom=document.createElement("textarea"),this.dom.setAttribute("class","art-editor-md"),this.dom.addEventListener("input",(function(e){e.target.style.height=this.scrollHeight+"px"})),this.dom},e.prototype.open=function(){this.dom.style.display="inherit"},e.prototype.close=function(){this.dom.style.display="none"},e.prototype.getMd=function(){return this.dom.value},e.prototype.setMd=function(e){this.dom.value=e,this.dom.style.height=this.dom.scrollHeight+5+"px"},e.prototype.attachAllEvent=function(){var e=this.dom,t=this.artText.get("$eventCenter").attachDOMEvent(this.dom,"input",(function(t){return t.target.style.height=e.scrollHeight+"px"}));this.DOMEvents.push(t)},e.prototype.detachAllEvent=function(){for(var e=0,t=this.DOMEvents;e<t.length;e++){var n=t[e];this.artText.get("$eventCenter").detachDOMEvent(n)}},e}(),bt={install:function(e,t){t.Tool.addCss(".art-editor-md{width:100%;min-height:200px;border:none;outline:none;resize:none;display:none}"),t.container.bind("textareaRender",gt,[{get:"art"}],!0)},created:function(e,t){e.get("$editor").addRender("textareaRender",e.get("textareaRender"))}},vt={created:function(e,t){e.get("toolbar").add({title:"导出",click:function(){var t=e.get("$editor").getFile(),n="arttext";t.name&&(n=t.name);var r=document.createElement("a");r.download=n+".md",r.style.display="none";var i=new Blob([t.markdown]);r.href=URL.createObjectURL(i),document.body.appendChild(r),r.click(),document.body.removeChild(r)}})}},yt={created:function(e,t){e.get("toolbar").add({title:"导入",click:function(){var t=document.createElement("input");t.type="file",t.accept=".md",t.style.display="none",document.body.appendChild(t),t.click(),t.onchange=function(){var n=new FileReader;n.onload=function(){e.get("$editor").openFile({name:t.files[0].name.replace(/.md$/,""),defaultMd:n.result.toString()})},n.readAsText(t.files[0],"utf8")},document.body.removeChild(t)}})}},Ct={created:function(e,t){e.get("toolbar").add({title:"新建",click:function(){return e.get("$editor").openFile()}})}},xt={created:function(e,t){e.get("toolbar").add({title:'<span title="项目地址">Github</span>',click:function(){return window.open("https://github.com/liziqiang9/ArtText")}})}},_t=function(){function e(e){this.artText=e,this.title="默认",this.spanElement=null,this.abbrNames=[],this.renderNames=[];var t=this;this.artText.get("$eventCenter").on("@switchRenderButton-addRender",(function(e,n){t.addRender(e,n)}))}return e.prototype.addRender=function(e,t){this.abbrNames.push(e),this.renderNames.push(t)},e.prototype.click=function(){var e=this.abbrNames.indexOf(this.title);if(e>-1){++e==this.abbrNames.length&&(e=0),this.title=this.abbrNames[e],this.spanElement.innerHTML=this.abbrNames[e];try{this.artText.get("$editor").switchRender(this.renderNames[e])}catch(e){console.error(e),this.artText.get("message").create("切换渲染器失败","error")}}},e}(),wt={install:function(e,t){t.container.bind("switchRenderButton",_t,[{get:"art"}],!0)},created:function(e,t){var n=e.get("switchRenderButton");n.abbrNames.length>0&&(n.title=n.abbrNames[0]),n.spanElement=e.get("toolbar").add({title:n.title,click:function(){return n.click()}})}},kt=function(){function e(e){this.artText=e,this.dom=document.createElement("div"),this.dom.setAttribute("class","art-toolbar-min");var t=this.dom;this.dom.onmouseover=function(){for(var e=1;e<t.childNodes.length;e++)t.childNodes[e].style.display="inherit"},this.dom.onmouseout=function(){for(var e=1;e<t.childNodes.length;e++)t.childNodes[e].style.display="none"},this.artText.get("$tool").add([{dom:this.dom,place:"Editor.before"}])}return e.prototype.add=function(e){return null==e.level&&(e.level=0),this.addBotton(e.title,(function(){return e.click()}),e.level)},e.prototype.addBotton=function(e,t,n){void 0===n&&(n=0);var r=document.createElement("div");return r.setAttribute("class","art-toolbar-min-div"),0!=this.dom.childNodes.length&&(r.style.display="none"),r.innerHTML=e,r.addEventListener("click",t),this.dom.appendChild(r),r},e}(),Nt={install:function(e,t){i.b.use(wt),i.b.use(Ct),i.b.use(yt),i.b.use(vt),i.b.use(xt),t.container.bind("toolbar",kt,[{get:"art"}],!0),t.Tool.addCss(".art-toolbar-min{width:80px;position: fixed;margin-left: 815px;font-weight:800;font-size:13.5px;text-align: center;background-color: #fff;box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);border-radius: 3px;padding: 3px 0;color: #666;}.art-toolbar-min-div{padding:7px 16px;cursor:pointer;} .art-toolbar-min-div:hover{background-color: #f2f2f2;color: #1abc9c;}")},created:function(e,t){e.get("toolbar")}},At=function(){function e(e){this.dom=document.createElement("div"),this.dom.setAttribute("class","art-tool-message"),this.timer=null,e.get("$tool").add([{dom:this.dom}])}return e.prototype.create=function(e,t){void 0===t&&(t="null");var n=document.createElement("div");n.setAttribute("class","art-tool-message-body");var r=document.createElement("p");r.innerHTML=e,r.style.fontSize="13px",r.style.fontWeight="600",r.style.height="100%",r.style.margin="0",n.appendChild(r),"info"==t?(n.style.backgroundColor="#edf2fc",n.style.borderColor="#EBEEF5",n.style.color="#909399"):"success"==t?(n.style.backgroundColor="#f0f9eb",n.style.borderColor="#e1f3d8",n.style.color="#67C23A"):"warning"==t?(n.style.backgroundColor="#fdf6ec",n.style.borderColor="#faecd8",n.style.color="#E6A23C"):"error"==t?(n.style.backgroundColor="#fde2e2",n.style.borderColor="#e1f3d8",n.style.color="#F56C6C"):(n.style.backgroundColor=We.b.theme.backgroundColor,n.style.color=We.b.theme.color),this.addMessage(n)},e.prototype.addMessage=function(e){if(!this.timer){var t=this;this.timer=setTimeout((function(){t.delMessage()}),3e3)}e.style.top=(40+60*this.dom.childNodes.length).toString()+"px",this.dom.appendChild(e)},e.prototype.delMessage=function(){this.dom.removeChild(this.dom.childNodes[0]);for(var e=0;e<this.dom.childNodes.length;e++)this.dom.childNodes[e].style.top=(40+60*e).toString()+"px";if(this.dom.childNodes.length){var t=this;this.timer=setTimeout((function(){t.delMessage()}),3e3)}},e}(),Dt={install:function(e,t){t.container.bind("message",At,[{get:"art"}],!0),t.Tool.addCss(".art-tool-message-body{overflow:hidden;box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);border-radius: 4px;left: 50%;margin: -27px 0 0 -170px;position: fixed;position: fixed !important;top: 40px;height: 40px;line-height: 40px;width: 340px;padding: 1px 10px 1px 15px;transition: opacity .3s,transform .4s,top .4s,-webkit-transform .4s;z-index: 1000;}")},created:function(e,t){e.get("message")}},Et={created:function(e,t){e.get("toolbar").add({title:"历史",click:function(){return e.get("versionHistory").open()}})}},Tt={created:function(e,t){e.get("toolbar").add({title:"保存",click:function(){return e.get("$eventCenter").emit("art-save")}})}},Lt=function(){function e(e){var t=this;this.art=e,this.dom=document.createElement("div"),this.dom.setAttribute("class","art-VersionHistoryTool"),this.dom.style.display="none",this.maskLayer=document.createElement("div"),this.maskLayer.setAttribute("class","art-VersionHistoryTool-MaskLayer"),this.maskLayer.style.display="none",this.getRootDomChilds(),this.art.get("$tool").add([{dom:this.dom},{dom:this.maskLayer}]),this.art.get("$eventCenter").on("art-save",(function(){return t.save()}))}return e.prototype.getRootDomChilds=function(){var e,t=document.createElement("span");t.style.position="absolute",t.style.right="-60px",t.style.padding="12px",t.style.cursor="pointer",t.style.color="#fff",t.innerHTML='<svg class="icon" style="width: 30px; height: 30px;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1187"><path d="M557.252647 512l135.75794 135.75794c12.495592 12.495592 12.495592 32.757055 0 45.252647-12.495592 12.495592-32.757055 12.495592-45.252647 0L512 557.252647 376.24206 693.010587c-12.496615 12.496615-32.757055 12.495592-45.252647 0-12.495592-12.495592-12.496615-32.756031 0-45.252647l135.75794-135.75794L330.989413 376.24206c-12.496615-12.496615-12.495592-32.757055 0-45.252647 12.495592-12.495592 32.756031-12.496615 45.252647 0l135.75794 135.75794 135.75794-135.75794c12.495592-12.495592 32.756031-12.495592 45.252647 0 12.495592 12.495592 12.495592 32.757055 0 45.252647L557.252647 512z m-429.233972 0c0 212.062813 171.918511 383.981325 383.981325 383.981325s383.981325-171.918511 383.981325-383.981325S724.06179 128.018675 512 128.018675 128.018675 299.937187 128.018675 512z m-63.997569 0c0-247.406786 200.572108-447.978894 447.978894-447.978894S959.977871 264.593214 959.977871 512 759.405763 959.977871 512 959.977871 64.021106 759.405763 64.021106 512z" p-id="1188"></path></svg>',t.onclick=(e=this,function(){e.close()});var n=document.createElement("div");n.style.display="flex",n.style.width="210px",n.style.flexDirection="column",n.style.borderRight="1px solid #ebebeb";var r=document.createElement("div");r.style.padding="12px 20px",r.style.fontWeight="600",r.style.display="flex",r.innerHTML="历史版本";var i=document.createElement("div");i.style.display="flex",i.style.flexDirection="column",i.style.justifyContent="center",i.style.overflow="auto",this.sideDraftHistoryDirectory=document.createElement("div"),i.appendChild(this.sideDraftHistoryDirectory),this.sideDraftHistoryDirectory.style.overflow="auto",null!=localStorage.art_articles?this.art_articles=JSON.parse(localStorage.art_articles):(this.art_articles={},localStorage.art_articles=JSON.stringify(this.art_articles)),n.appendChild(r),n.appendChild(i);var o=document.createElement("div");o.style.flex="1 1",o.style.display="flex",o.style.flexDirection="column",o.style.overflow="auto",this.mainArticle=document.createElement("div"),this.mainArticle.style.flex="1 1",this.mainArticle.style.display="flex",this.mainArticle.style.overflow="auto",this.mainArticle.innerHTML='<textarea style="width: 100%;border: none;resize: none;outline: none;padding:13px 15px;font-size: 15px" readonly class="markdown-body">无打开</textarea>',this.mainFooter=document.createElement("div"),this.mainFooter.style.height="52px",this.mainFooter.style.display="flex",this.mainFooter.style.borderTop="1px solid #ebebeb",this.mainFooter.style.alignItems="center",this.mainFooter.style.padding="0 20px",this.footerDel=document.createElement("button"),this.footerDel.setAttribute("style","border-radius: 18px;margin-right: 20px;color:#e01a1a;border:none;padding: 7px;font-size: 13px;font-weight: 600;background: rgba(239, 26, 26, 0.08);cursor: pointer;"),this.footerDel.innerHTML='<svg class="icon" style="width: 17px; height: 17px;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="689"><path d="M800.162002 316.659033c1.850138-17.575284 17.596773-30.322609 35.172058-28.473495 17.575284 1.850138 30.322609 17.596773 28.473494 35.172058l-57.966202 550.673811c-5.143137 48.856731-46.341445 85.946464-95.467306 85.946464H313.625954c-49.126884 0-90.325192-37.089733-95.468329-85.946464L160.192446 323.358619c-1.850138-17.575284 10.898211-33.32192 28.472471-35.172057 17.575284-1.850138 33.32192 10.898211 35.172058 28.473494l57.965179 550.672788c1.714038 16.285918 15.446807 28.64848 31.822776 28.648481h396.74707c16.375969 0 30.108738-12.363585 31.822776-28.648481l57.967226-550.673811z m-192.176904 99.345636c17.672498 0 31.998785 14.326287 31.998785 31.998785v223.989447c0 17.672498-14.326287 31.998785-31.998785 31.998785s-31.998785-14.326287-31.998785-31.998785V448.00243c0-17.671475 14.326287-31.997762 31.998785-31.997761z m-191.990662 0c17.672498 0 31.998785 14.326287 31.998785 31.998785v223.989447c0 17.672498-14.326287 31.998785-31.998785 31.998785s-31.998785-14.326287-31.998785-31.998785V448.00243c0-17.671475 14.326287-31.997762 31.998785-31.997761z m-31.998785-223.989447h255.987209v-47.998178c0-8.836249-7.163143-15.999392-15.999393-15.999392H399.995043c-8.836249 0-15.999392 7.163143-15.999392 15.999392v47.998178z m-63.996546 0V128.018675c0-35.344996 28.652574-63.996546 63.997569-63.996546h255.987209c35.343973 0 63.996546 28.652574 63.996546 63.996546v63.996547h223.99968c17.672498 0 31.998785 14.326287 31.998785 31.998785s-14.326287 31.998785-31.998785 31.998784H96.019891c-17.672498 0-31.998785-14.326287-31.998785-31.998784s14.326287-31.998785 31.998785-31.998785h223.979214z" p-id="690"></path></svg>',this.footerTag=document.createElement("button"),this.footerTag.setAttribute("style","border-radius: 18px;margin-right: 20px;color:#ebeb18;border:none;padding: 7px;font-size: 13px;font-weight: 600;background: rgba(229, 229, 109, 0.1);cursor: pointer;"),this.footerTag.innerHTML='<svg class="icon" style="width: 18px; height: 18px;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2298"><path d="M512 64.021106c-11.816117 0-23.63121 6.791683-28.127617 20.375049l-97.82705 295.566646H93.719498c-27.710109 0-40.267099 34.785248-18.987446 52.612265L304.048831 624.711038l-82.039481 297.444413c-5.655813 20.513196 10.561543 37.82242 28.662806 37.82242 5.698792 0 11.585873-1.717108 17.030885-5.588275l244.296959-173.672458L756.301052 954.389596c5.445012 3.873214 11.335163 5.588275 17.030885 5.588275 18.10024 0 34.31862-17.310248 28.65462-37.82242L719.951169 624.712061l229.316779-192.135972c21.280676-17.827017 8.725732-52.612265-18.991539-52.612264H637.954667L540.127617 84.396155c-4.496407-13.583366-16.311501-20.37505-28.127617-20.375049z" p-id="2299"></path></svg>',this.footerRestore=document.createElement("button"),this.footerRestore.setAttribute("style","border-radius: 6px;flex: 1 1;color:#1aba9c;border:none;padding: 6px 15px;font-size: 13px;font-weight: 600;background: rgba(26, 186, 156, 0.08);cursor: pointer;"),this.footerRestore.innerHTML="恢复",this.mainFooter.appendChild(this.footerDel),this.mainFooter.appendChild(this.footerTag),this.mainFooter.appendChild(this.footerRestore),o.appendChild(this.mainArticle),o.appendChild(this.mainFooter),this.dom.appendChild(t),this.dom.appendChild(n),this.dom.appendChild(o)},e.prototype.open=function(){this.dom.style.display="flex",this.maskLayer.style.display="inline",this.art_articles=JSON.parse(localStorage.art_articles),document.body.style.overflow="hidden",this.mainArticle.childNodes[0].innerHTML="",this.updateDirectory()},e.prototype.updateDirectory=function(){this.sideDraftHistoryDirectory.innerHTML="";for(var e=this.art.get("$editor").getFile("fileInfo"),t=function(t){var r=document.createElement("div");r.style.height="60px",r.style.padding="10px 20px 0",r.style.cursor="pointer";var i=new Date(1*parseInt(n.art_articles[t].time)).toLocaleString().replace(/\//g,"-").substring(0,16),o=n.art_articles[t].name;if(e.id&&e.id==t){o="@当前草稿";for(var s=n.art_articles[t],a=localStorage[s.id],l=n.sideDraftHistoryDirectory.getElementsByClassName("art-VersionHistoryTool-selected"),d=l.length-1;d>=0;d--){var c=l[d].getAttribute("class");c=c.replace("art-VersionHistoryTool-selected",""),l[d].setAttribute("class",c)}r.setAttribute("class","art-VersionHistoryTool-selected"),n.mainArticle.childNodes[0].innerHTML=a,n.mainFooter.style.display="inherit";var h=n;n.footerDel.onclick=function(){localStorage.removeItem(s.ids[0]),delete h.art_articles[s.id],h.updateDirectory(),h.art.get("message").create(s.name+"已删除","success")},n.footerRestore.onclick=function(){h.art.get("$editor").openFile(a,s),h.art.get("message").create(s.name+"已恢复","success"),h.close()}}r.innerHTML='<div style="font-weight: 500;">'+i+'</div><div style="font-size: 12px;color: #555;">'+o+"</div>",r.onclick=n.restoreMdFile(n.art_articles[t]),n.sideDraftHistoryDirectory.appendChild(r)},n=this,r=0,i=Object.keys(this.art_articles).reverse();r<i.length;r++){t(i[r])}},e.prototype.restoreMdFile=function(e){var t=localStorage[e.id],n=this;return function(){for(var r=n.sideDraftHistoryDirectory.getElementsByClassName("art-VersionHistoryTool-selected"),i=r.length-1;i>=0;i--){var o=r[i].getAttribute("class");o=o.replace("art-VersionHistoryTool-selected",""),r[i].setAttribute("class",o)}this.setAttribute("class","art-VersionHistoryTool-selected"),n.mainArticle.childNodes[0].innerHTML=t,n.mainFooter.style.display="inherit",n.footerDel.onclick=function(){localStorage.removeItem(e.ids[0]),delete n.art_articles[e.id],n.updateDirectory(),n.art.get("message").create(e.name+"已删除","success")},n.footerRestore.onclick=function(){e.defaultMd=t,n.art.get("$editor").openFile(e),n.art.get("message").create(e.name+"已恢复","success"),n.close()}}},e.prototype.save=function(){var e=this.art.get("$editor").getFile(),t=JSON.parse(localStorage.art_articles);if(e.id&&t.hasOwnProperty(e.id))localStorage[e.id]=e.markdown,t[e.id]=e,localStorage.art_articles=JSON.stringify(t),this.art.get("message").create("保存成功","success");else{var n=(new Date).getTime(),r="art_md_"+n+"_",i=r;e.name&&(r+=e.name,i=e.name),localStorage[r]=e.markdown,t[r]={ids:[r],time:n,name:i,id:r},localStorage.art_articles=JSON.stringify(t);var o=t[r];o.defaultMd=e.markdown,this.art.get("$editor").openFile(Object.assign(e,o)),this.art.get("message").create("保存成功","success")}},e.prototype.close=function(){localStorage.art_articles=JSON.stringify(this.art_articles),this.maskLayer.style.display="none",this.dom.style.display="none",document.body.style.overflow="auto"},e}(),Ot={install:function(e,t){i.b.use(Et),i.b.use(Tt),t.container.bind("versionHistory",Lt,[{get:"art"}],!0),t.Tool.addCss(".art-VersionHistoryTool{position: fixed;z-index:10;width:60vw;right:20vw;height:92vh;top:4vh;background-color:#fff;box-shadow:0 2px 4px rgba(0, 0, 0, .12), 0 0 6px rgba(0, 0, 0, .04);border-radius: 2px}\n        .art-VersionHistoryTool-MaskLayer{position:fixed;top:0;right:0;bottom:0;left:0;background: rgba(26,26,26,.65);z-index:1}\n        .art-VersionHistoryTool-selected{color: #1aba9c}")},created:function(e,t){e.get("versionHistory")}},St=function(){function e(e){this.art=e,this.dom=document.createElement("div"),this.dom.setAttribute("class","art-sidebar"),this.openOrCloseFlag=!0,this.menuDom=document.createElement("div"),this.menuDom.setAttribute("class","art-sidebar-menu"),this.dom.appendChild(this.menuDom);var t=document.createElement("span");t.setAttribute("style","flex: 1"),this.menuDom.appendChild(t),this.mainDom=document.createElement("div"),this.mainDom.setAttribute("class","art-sidebar-main"),this.dom.appendChild(this.mainDom),this.selectMenuDom=null,this.info=new Map,this.art.get("$tool").add([{dom:this.dom,place:"Editor.before"}])}return e.prototype.add=function(e,t){this.info.set(e,t);var n=document.createElement("span");n.setAttribute("class","art-sidebar-menu-span"),n.innerHTML=e,this.menuDom.appendChild(n);var r=document.createElement("span");r.setAttribute("style","flex: 1"),this.menuDom.appendChild(r),t.style.display="none",this.mainDom.appendChild(t);var i=this;n.onclick=function(){i.openOption(this)},this.selectMenuDom||n.click()},e.prototype.openOption=function(e){this.selectMenuDom&&(this.selectMenuDom.classList.remove("art-sidebar-menu-select"),this.info.get(this.selectMenuDom.innerHTML).style.display="none"),this.selectMenuDom=e,e.classList.add("art-sidebar-menu-select"),this.info.get(this.selectMenuDom.innerHTML).style.display="inherit"},e.prototype.openOrClose=function(){this.openOrCloseFlag?this.dom.style.display="none":this.dom.style.display="inherit",this.openOrCloseFlag=!this.openOrCloseFlag},e}(),Rt={install:function(e,t){i.b.use(Ft),t.container.bind("sidebar",St,[{get:"art"}],!0),t.Tool.addCss(".art-sidebar{width:300px;margin-left: -333px;top: 20px;bottom: 20px;position: fixed;font-size:13.5px;background-color: #fff;box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);border-radius: 3px;color: #666;}                                 .art-sidebar-menu{height: 28px;display: flex;border-bottom: 1px #eee solid;font-weight: 600;padding: 10px 20px 6px;text-align:center;font-size: 14px}.art-sidebar-menu-span{padding: 0 15px 5px;cursor: pointer;}                                .art-sidebar-menu-select{border-bottom: 4px #666 solid;}                                .art-sidebar-main{height: calc(100% - 50px);padding: 3px 0 4px}")},created:function(e,t){return e.get("sidebar")}},Ft={created:function(e,t){return e.get("toolbar").add({title:"侧边栏",click:function(){return e.get("sidebar").openOrClose()}})}},Mt=function(){function e(e){this.dom=document.createElement("div"),this.dom.setAttribute("class","art-outlineSidebar"),this.art=e;var t=this;e.get("$eventCenter").on("artRender-render",(function(){return t.updataToc()}))}return e.prototype.updataToc=function(){this.dom.innerHTML="";for(var e=this.art.get("$artRender").doc.firstChild;e;){if("heading"===e.type){var t=e.getMd();t=t.replace(/\s/g,"-").replace(/\\|\/|#|\:/g,"");var n=document.createElement("p");n.setAttribute("class","art-outlineSidebar-h"+e._level);var r=document.createElement("a");r.href="#"+t,r.innerHTML=e.getText(),n.appendChild(r),this.dom.appendChild(n)}e=e.next}},e}(),Bt={install:function(e,t){t.container.bind("outlineSidebar",Mt,[{get:"art"}],!0),t.Tool.addCss(".art-outlineSidebar{height: 100%;overflow: hidden;}.art-outlineSidebar:hover {overflow: auto}        .art-outlineSidebar-h1{padding-left: 0.6em;}.art-outlineSidebar-h2{padding-left: 1em;}.art-outlineSidebar-h3{padding-left: 2em;}        .art-outlineSidebar-h4{padding-left: 3em;;}.art-outlineSidebar-h5{padding-left: 4em;;}.art-outlineSidebar-h6{padding-left: 5em;}            .art-outlineSidebar p{margin:0; font-size: 12px;padding-right:5px;}.art-outlineSidebar p:hover{background-color: #eee;}            .art-outlineSidebar a{color: inherit;;text-decoration: none;width: 100%;display: block;padding: 8px 0}                .art-outlineSidebar::-webkit-scrollbar {width: 10px;height:0}            .art-outlineSidebar::-webkit-scrollbar-thumb {background: #ccc;}            ")},created:function(e){e.get("sidebar").add("大纲",e.get("outlineSidebar").dom)}},Ht=function(){function e(e){var t=this;this.dom=document.createElement("div"),this.dom.setAttribute("class","art-fileSidebar"),this.art=e,this.file={path:"/src",files:[{path:"/src/index.ts",name:"index.ts",type:"ts"}],name:"src",type:""},this.openFolderDom=document.createElement("div"),this.openFolderDom.setAttribute("class","art-fileSidebar-openFolder"),this.openFolderDom.innerHTML="打开文件夹",this.openFolderDom.onclick=function(){return t.openFolder()},this.dom.appendChild(this.openFolderDom),this.folderDom=document.createElement("ul"),this.dom.appendChild(this.folderDom)}return e.prototype.openFolder=function(){var e=this;this.art.get("artRequest").get("/openFolder").then((function(t){e.file=t,e.updata()}))},e.prototype.updata=function(){this.folderDom.innerHTML="";var e=this.openFile(this.file);this.selectDom=e.childNodes[0],this.selectDom.classList.add("art-fileSidebar-select"),this.folderDom.appendChild(e)},e.prototype.openFile=function(e){var t=this,n=document.createElement("li"),r=document.createElement("span");if(r.setAttribute("art-path",e.path),r.setAttribute("art-fileSidebar-type",e.type),r.innerHTML=e.name,n.appendChild(r),"folder"==e.type){var i=document.createElement("ul");if(e.files)for(var o=0,s=e.files;o<s.length;o++){var a=s[o];i.appendChild(this.openFile(a))}n.appendChild(i)}else n.setAttribute("class","art-fileSidebar-file");return r.onclick=function(){var e=this;t.selectDom.classList.remove("art-fileSidebar-select"),t.selectDom=this,t.selectDom.classList.add("art-fileSidebar-select");var n=t.selectDom.getAttribute("art-path");"folder"==t.selectDom.getAttribute("art-fileSidebar-type")?t.art.get("artRequest").get("/openFolder?path="+n).then((function(n){e.parentElement.parentElement.replaceChild(t.openFile(n),e.parentElement)})):t.art.get("artRequest").get("/openFileText?path="+n).then((function(e){console.log(e),t.art.get("$editor").openFile(e)}))},n},e}(),zt={install:function(e,t){t.container.bind("fileSidebar",Ht,[{get:"art"}],!0),t.Tool.addCss(".art-fileSidebar-file{list-style: none;margin-left: -18px;}.art-fileSidebar{padding: 0 10px;height: 100%;overflow: auto;}.art-fileSidebar-openFolder{text-align: center;margin: 1em 30px 0.6em;padding: 6px;cursor: pointer;background: #1abc9c;color: #fff;font-weight: 600;}.art-fileSidebar-openFolder:hover{background: #1abc9ce0;}        .art-fileSidebar ul{margin: 0; padding-left: 18px}.art-fileSidebar li{margin-top: 5px;}.art-fileSidebar span{width: calc(100% - 6px);;display: inline-block;cursor: pointer;padding: 2px 0 2px 6px}.art-fileSidebar span:hover{background-color: #eee}        .art-fileSidebar::-webkit-scrollbar {width: 10px;height:0}            .art-fileSidebar::-webkit-scrollbar-thumb {background: #ccc;}.art-fileSidebar-select{font-weight: bolder;}")},created:function(e){e.get("sidebar").add("文件",e.get("fileSidebar").dom)}},$t=function(){function e(e,t){this.xhr=new XMLHttpRequest,this.method=e,this.url=t,this.contentType=!0}return e.prototype.then=function(e){return this.xhr.onreadystatechange=function(){4==this.readyState&&200==this.status&&e(JSON.parse(this.responseText))},this.xhr.open(this.method,this.url,!0),"POST"==this.method&&null!=this.data?(this.contentType&&this.xhr.setRequestHeader("Content-type","application/json"),this.xhr.send(this.data)):this.xhr.send(),this},e}(),Pt=function(){function e(e){this.rootUrl=e}return e.prototype.get=function(e){return new $t("GET",this.rootUrl+e)},e.prototype.post=function(e,t,n){void 0===t&&(t=void 0),void 0===n&&(n=!0);var r=new $t("POST",this.rootUrl+e);return r.contentType=n,r.data=null!=t&&n?JSON.stringify(t):t,r},e}(),jt={install:function(e,t){t.container.bind("artRequest",Pt,["http://127.0.0.1:8000/api"])},created:function(e,t){}},It=function(){function e(e){var t=this;this.art=e,this.art.get("$eventCenter").on("art-save",(function(){return t.save()})),this.art.get("$eventCenter").on("art-uploadImage",(function(e){return t.uploadImage(e[0],e[1])}))}return e.prototype.save=function(){var e=this,t=this.art.get("$editor").getFile();console.log(t);var n={markdown:t.markdown,path:t.path};console.log(n),this.art.get("artRequest").post("/saveFileText",n).then((function(t){200==t.StatusCode&&e.art.get("message").create("提交成功","success")}))},e.prototype.uploadImage=function(e,t){var n=this,r=this.art.get("$editor").fileInfo,i=new FormData;i.append("image",e);var o="";null!=r.path&&(o=r.path),i.append("path",o),this.art.get("artRequest").post("/uploadImage",i,!1).then((function(e){n.art.get("message").create("提交成功","success"),t(e.url,e.name)}))},e}(),qt={install:function(e,t){t.container.bind("artLocal",It,[{get:"art"}],!0)},created:function(e,t){e.get("artLocal")}};t.default=r.b;i.b.use(r.a),i.b.use(o.a),i.b.use(h),i.b.use(f),i.b.use(mt),i.b.use(Nt),i.b.use(Rt),i.b.use(Bt),i.b.use(Dt),i.b.use(Ot),i.b.use(bt),i.b.use(zt),i.b.use(jt),i.b.use(qt)}]);